var __extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},NumJS;!function(e){function t(t,a){return void 0===a&&(a=e.DEFAULT_TYPE_INSTANCE),new a(t)}function a(e,t){for(var a=0,i=e.length;a<i;++a)e[a]=t;return e}function i(e){for(var t=1,a=0,i=e.length;a<i;++a)t*=e[a];return t}function o(e){for(var t=0,a=0,i=e.length;a<i;++a)t+=e[a];return t}function n(e,t){if(e.length===t.length){for(var a=0,i=e.length;a<i;++a)e[a]+=t[a];return e}throw new TypeError("Bad input shapes "+e.length+" "+t.length)}function r(e,t){for(var a=0,i=e.length;a<i;++a)e[a]+=t;return e}function p(e,t){if(e.length===t.length){for(var a=0,i=e.length;a<i;++a)e[a]-=t[a];return e}throw new TypeError("Bad input shape "+e.length+" "+t.length)}function l(e,t){for(var a=0,i=e.length;a<i;++a)e[a]-=t;return e}function s(e,t){if(e.length===t.length){for(var a=0,i=e.length;a<i;++a)e[a]*=t[a];return e}throw new TypeError("Bad input shape "+e.length+" "+t.length)}function d(e,t){for(var a=0,i=e.length;a<i;++a)e[a]*=t;return e}function u(e,t){if(e.length===t.length){for(var a=0,i=e.length;a<i;++a)e[a]/=t[a];return e}throw new TypeError("Bad input shape "+e.length+" "+t.length)}function m(e,t){for(var a=0,i=e.length;a<i;++a)e[a]/=t;return e}function h(e,t,a){if(e.length===t.length){for(var i=0,o=e.length;i<o;++i)e[i]+=a*t[i];return e}throw new TypeError("Bad input shape "+e.length+" "+t.length)}e.DEFAULT_TYPE_INSTANCE=Float32Array,e.zeros=t,e.fill=a,e.prod=i,e.sum=o,e.add=n,e.addConst=r,e.sub=p,e.subConst=l,e.mul=s,e.mulByConst=d,e.div=u,e.divByConst=m,e.addScaled=h}(NumJS||(NumJS={}));var NumJS;!function(e){function t(e){for(var t=Number.NEGATIVE_INFINITY,a=0,i=e.length;a<i;++a)e[a]>t&&(t=e[a]);return t}function a(e){for(var t=Number.NEGATIVE_INFINITY,a=0,i=0,o=e.length;i<o;++i)e[i]>t&&(t=e[i],a=i);return a}function i(e,t){return t=t||3,e.slice(0).sort(function(e,t){return t-e}).slice(0,t)}function o(e,t){t=t||3;for(var a=e.length,i=new Uint32Array(a),o=0;o<a;++o)i[o]=o;return i.sort(function(t,a){return e[a]-e[t]}).slice(0,t)}function n(e){if(0===e.length)return{};for(var t=e[0],a=e[0],i=0,o=0,n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n],i=n),e[n]<a&&(a=e[n],o=n);return{maxi:i,maxv:t,mini:o,minv:a,dv:t-a}}e.max=t,e.argmax=a,e.maxn=i,e.argmaxn=o,e.maxmin=n}(NumJS||(NumJS={}));var NumJS;!function(e){function t(){if(r)return r=!1,p;var e=2*Math.random()-1,a=2*Math.random()-1,i=e*e+a*a;if(0==i||i>1)return t();var o=Math.sqrt(-2*Math.log(i)/i);return p=a*o,r=!0,e*o}function a(e,t){return Math.random()*(t-e)+e}function i(e,t){return Math.floor(Math.random()*(t-e)+e)}function o(e,a){return e+t()*a}function n(e){for(var t,a=e,i=0,o=[],n=0;n<e;++n)o[n]=n;for(;a--;)i=Math.floor(Math.random()*(a+1)),t=o[a],o[a]=o[i],o[i]=t;return o}var r=!1,p=0;e.gaussRandom=t,e.randf=a,e.randi=i,e.randn=o,e.randperm=n}(NumJS||(NumJS={}));var NumJS;!function(e){function t(e,t,a){return Math.max(Math.min(e,a),t)}function a(e,t){return(e%t+t)%t}function i(e){var t=Math.exp(2*e);return(t-1)/(t+1)}e.clip=t,e.mod=a,e.tanh=i}(NumJS||(NumJS={}));var Net;!function(e){var t=NumJS,a=function(){function e(e,a,i,o){this.sx=e,this.sy=a,this.depth=i;var n=this.sx*this.sy*this.depth;if(this.w=t.zeros(n),void 0===o)for(var r=Math.sqrt(1/n),p=0;p<n;++p)this.w[p]=t.randn(0,r);else 0!==o&&t.fill(this.w,o)}return e.fromArray=function(t){var a=new e(1,1,t.length,0);return a.w.set(t),a},e.prototype.clone=function(){var t=new e(this.sx,this.sy,this.depth,0);return t.w.set(this.w),t},e.prototype.cloneAndZero=function(){var t=new e(this.sx,this.sy,this.depth,0);return t},e.prototype.get=function(e,t,a){var i=(this.sx*t+e)*this.depth+a;return this.w[i]},e.prototype.set=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;this.w[o]=i},e.prototype.add=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;return this.w[o]+=i,this},e.prototype.sub=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;return this.w[o]-=i,this},e.prototype.mul=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;return this.w[o]*=i,this},e.prototype.div=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;return this.w[o]/=i,this},e.prototype.get_grad=function(e,t,a){var i=(this.sx*t+e)*this.depth+a;return this.dw[i]},e.prototype.set_grad=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;this.dw[o]=i},e.prototype.add_grad=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;this.dw[o]+=i},e.prototype.sub_grad=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;this.dw[o]-=i},e.prototype.mul_grad=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;this.dw[o]*=i},e.prototype.div_grad=function(e,t,a,i){var o=(this.sx*t+e)*this.depth+a;this.dw[o]/=i},e.prototype.roll=function(e,a,i){void 0===e&&(e=0),void 0===a&&(a=0),void 0===i&&(i=0);for(var o=this.clone(),n=0,r=o.depth;n<r;++n)for(var p=0,l=o.sx;p<l;++p)for(var s=0,d=o.sy;s<d;++s){var u=this.get(t.mod(p+e,this.sx),t.mod(s+a,this.sy),t.mod(n+i,this.depth));o.set(p,s,n,u)}return o},e.prototype.zoom=function(t,a,i){void 0===t&&(t=1),void 0===a&&(a=1),void 0===i&&(i=1);for(var o=new e(Math.round(this.sx*t),Math.round(this.sy*a),Math.round(this.depth*i),0),n=0,r=o.depth;n<r;++n)for(var p=0,l=o.sx;p<l;++p)for(var s=0,d=o.sy;s<d;++s){for(var u=0,m=Math.ceil(1/t),h=Math.ceil(1/a),y=Math.ceil(1/i),f=Math.ceil(p/t),_=Math.ceil(s/a),c=Math.ceil(n/i),g=Math.min(f+m,this.sx),v=Math.min(_+h,this.sy),P=Math.min(c+y,this.depth),w=f;w<g;w++)for(var N=_;N<v;N++)for(var b=c;b<P;b++){var S=this.get(w,N,b);o.add(p,s,n,S),u++}o.div(p,s,n,u)}return o},e.prototype.toJSON=function(){var e={};return e.sx=this.sx,e.sy=this.sy,e.depth=this.depth,e.w=this.w,e},e.fromJSON=function(t){var a=new e(t.sx,t.sy,t.depth,0);return a.w.set(t.w),a},e}();e.Vol=a}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(){function e(){}return e.prototype.getLayer=function(e){return this.layers.get(e)},e.prototype.setInputDimensions=function(e,t,a){void 0===a&&(a=3),this.layerIterator(function(i,o,n){0===o?(i.in_sx=e,i.in_sy=t,i.in_depth=a,i.updateDimensions()):i.updateDimensions(n)})},e.prototype.layerIterator=function(e,t){var a=this;void 0===t&&(t={});var i,o=[],n=[],r=0,p=d3.set();void 0===t.reverse||t.reverse===!1?(i=t.start?this.layers.get(t.start):this.layers.get("data"),n=this.edges):(i=t.start?this.layers.get(t.start):this.layers.values()[this.layers.size()-1],n=this.edges.map(function(e){return{from:e.to,to:e.from}}));var l=d3.map(d3.nest().key(function(e){return e.from}).entries(n),function(e){return e.key}),s=d3.map(d3.nest().key(function(e){return e.to}).entries(n),function(e){return e.key});for(o.push(i);o.length;){var d=o.pop();p.add(d.name);var u=s.get(d.name),m=void 0===u?void 0:u.values.map(function(e){return a.layers.get(e.from)});if(e(d,r++,m),t.end&&d.name===t.end)break;var h=l.get(d.name);h&&h.values.filter(function(e){return!p.has(e.to)}).forEach(function(e){var t=s.get(e.to),i=void 0===t?[]:t.values.filter(function(e){return!p.has(e.from)});0===i.length&&o.push(a.layers.get(e.to))})}},e.prototype.forward=function(e,t,a){void 0===t&&(t=!1),void 0===a&&(a={});var i,o=d3.map();return this.layerIterator(function(a,n,r){i=void 0===r?e:r.length>1?r.map(function(e){return o.get(e.name)}):o.get(r[0].name),i=a.forward(i,t),o.set(a.name,i)},a),i},e.prototype.backward=function(e,t){void 0===t&&(t={}),t.reverse=!0;var a;return this.layerIterator(function(t,i,o){void 0!==e&&0===i?a=t.backward(e):t.backward()},t),a},e.prototype.debugStructure=function(){var e=0,a=d3.format("s"),i=d3.format(",d"),o=0;this.layerIterator(function(a,n,r){var p=t.sum(a.getNumParameters()),l="";l+=a.getOutputShape().join("x")+" :: ",l+=a.getDescription().join(" "),p&&(e+=p,l+=" => "+i(p)+" parameters"),o+=1,console.log(l)}),console.log("---"),console.log("Total number of layers "+i(o)),console.log("Total number of params "+i(e)+" (memory: "+a(4*e)+"b): ")},e}();e.Net=a}(Net||(Net={}));var Parser;!function(e){dcodeIO.ProtoBuf.newBuilder({})["import"]({"package":"caffe",messages:[{name:"BlobShape",fields:[{rule:"repeated",type:"int64",name:"dim",id:1,options:{packed:!0}}]},{name:"BlobProto",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:7},{rule:"repeated",type:"float",name:"data",id:5,options:{packed:!0}},{rule:"repeated",type:"float",name:"diff",id:6,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_data",id:8,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_diff",id:9,options:{packed:!0}},{rule:"optional",type:"int32",name:"num",id:1,options:{"default":0}},{rule:"optional",type:"int32",name:"channels",id:2,options:{"default":0}},{rule:"optional",type:"int32",name:"height",id:3,options:{"default":0}},{rule:"optional",type:"int32",name:"width",id:4,options:{"default":0}}]},{name:"BlobProtoVector",fields:[{rule:"repeated",type:"BlobProto",name:"blobs",id:1}]},{name:"Datum",fields:[{rule:"optional",type:"int32",name:"channels",id:1},{rule:"optional",type:"int32",name:"height",id:2},{rule:"optional",type:"int32",name:"width",id:3},{rule:"optional",type:"bytes",name:"data",id:4},{rule:"optional",type:"int32",name:"label",id:5},{rule:"repeated",type:"float",name:"float_data",id:6},{rule:"optional",type:"bool",name:"encoded",id:7,options:{"default":!1}}]},{name:"FillerParameter",fields:[{rule:"optional",type:"string",name:"type",id:1,options:{"default":"constant"}},{rule:"optional",type:"float",name:"value",id:2,options:{"default":0}},{rule:"optional",type:"float",name:"min",id:3,options:{"default":0}},{rule:"optional",type:"float",name:"max",id:4,options:{"default":1}},{rule:"optional",type:"float",name:"mean",id:5,options:{"default":0}},{rule:"optional",type:"float",name:"std",id:6,options:{"default":1}},{rule:"optional",type:"int32",name:"sparse",id:7,options:{"default":-1}},{rule:"optional",type:"VarianceNorm",name:"variance_norm",id:8,options:{"default":"FAN_IN"}}],enums:[{name:"VarianceNorm",values:[{name:"FAN_IN",id:0},{name:"FAN_OUT",id:1},{name:"AVERAGE",id:2}]}]},{name:"NetParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"repeated",type:"string",name:"input",id:3},{rule:"repeated",type:"BlobShape",name:"input_shape",id:8},{rule:"repeated",type:"int32",name:"input_dim",id:4},{rule:"optional",type:"bool",name:"force_backward",id:5,options:{"default":!1}},{rule:"optional",type:"NetState",name:"state",id:6},{rule:"optional",type:"bool",name:"debug_info",id:7,options:{"default":!1}},{rule:"repeated",type:"LayerParameter",name:"layer",id:100},{rule:"repeated",type:"V1LayerParameter",name:"layers",id:2}]},{name:"SolverParameter",fields:[{rule:"optional",type:"string",name:"net",id:24},{rule:"optional",type:"NetParameter",name:"net_param",id:25},{rule:"optional",type:"string",name:"train_net",id:1},{rule:"repeated",type:"string",name:"test_net",id:2},{rule:"optional",type:"NetParameter",name:"train_net_param",id:21},{rule:"repeated",type:"NetParameter",name:"test_net_param",id:22},{rule:"optional",type:"NetState",name:"train_state",id:26},{rule:"repeated",type:"NetState",name:"test_state",id:27},{rule:"repeated",type:"int32",name:"test_iter",id:3},{rule:"optional",type:"int32",name:"test_interval",id:4,options:{"default":0}},{rule:"optional",type:"bool",name:"test_compute_loss",id:19,options:{"default":!1}},{rule:"optional",type:"bool",name:"test_initialization",id:32,options:{"default":!0}},{rule:"optional",type:"float",name:"base_lr",id:5},{rule:"optional",type:"int32",name:"display",id:6},{rule:"optional",type:"int32",name:"average_loss",id:33,options:{"default":1}},{rule:"optional",type:"int32",name:"max_iter",id:7},{rule:"optional",type:"int32",name:"iter_size",id:36,options:{"default":1}},{rule:"optional",type:"string",name:"lr_policy",id:8},{rule:"optional",type:"float",name:"gamma",id:9},{rule:"optional",type:"float",name:"power",id:10},{rule:"optional",type:"float",name:"momentum",id:11},{rule:"optional",type:"float",name:"weight_decay",id:12},{rule:"optional",type:"string",name:"regularization_type",id:29,options:{"default":"L2"}},{rule:"optional",type:"int32",name:"stepsize",id:13},{rule:"repeated",type:"int32",name:"stepvalue",id:34},{rule:"optional",type:"float",name:"clip_gradients",id:35,options:{"default":-1}},{rule:"optional",type:"int32",name:"snapshot",id:14,options:{"default":0}},{rule:"optional",type:"string",name:"snapshot_prefix",id:15},{rule:"optional",type:"bool",name:"snapshot_diff",id:16,options:{"default":!1}},{rule:"optional",type:"SnapshotFormat",name:"snapshot_format",id:37,options:{"default":"BINARYPROTO"}},{rule:"optional",type:"SolverMode",name:"solver_mode",id:17,options:{"default":"GPU"}},{rule:"optional",type:"int32",name:"device_id",id:18,options:{"default":0}},{rule:"optional",type:"int64",name:"random_seed",id:20,options:{"default":-1}},{rule:"optional",type:"string",name:"type",id:40,options:{"default":"SGD"}},{rule:"optional",type:"float",name:"delta",id:31,options:{"default":1e-8}},{rule:"optional",type:"float",name:"momentum2",id:39,options:{"default":.999}},{rule:"optional",type:"float",name:"rms_decay",id:38},{rule:"optional",type:"bool",name:"debug_info",id:23,options:{"default":!1}},{rule:"optional",type:"bool",name:"snapshot_after_train",id:28,options:{"default":!0}},{rule:"optional",type:"SolverType",name:"solver_type",id:30,options:{"default":"SGD"}}],enums:[{name:"SnapshotFormat",values:[{name:"HDF5",id:0},{name:"BINARYPROTO",id:1}]},{name:"SolverMode",values:[{name:"CPU",id:0},{name:"GPU",id:1}]},{name:"SolverType",values:[{name:"SGD",id:0},{name:"NESTEROV",id:1},{name:"ADAGRAD",id:2},{name:"RMSPROP",id:3},{name:"ADADELTA",id:4},{name:"ADAM",id:5}]}]},{name:"SolverState",fields:[{rule:"optional",type:"int32",name:"iter",id:1},{rule:"optional",type:"string",name:"learned_net",id:2},{rule:"repeated",type:"BlobProto",name:"history",id:3},{rule:"optional",type:"int32",name:"current_step",id:4,options:{"default":0}}]},{name:"NetState",fields:[{rule:"optional",type:"Phase",name:"phase",id:1,options:{"default":"TEST"}},{rule:"optional",type:"int32",name:"level",id:2,options:{"default":0}},{rule:"repeated",type:"string",name:"stage",id:3}]},{name:"NetStateRule",fields:[{rule:"optional",type:"Phase",name:"phase",id:1},{rule:"optional",type:"int32",name:"min_level",id:2},{rule:"optional",type:"int32",name:"max_level",id:3},{rule:"repeated",type:"string",name:"stage",id:4},{rule:"repeated",type:"string",name:"not_stage",id:5}]},{name:"ParamSpec",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"DimCheckMode",name:"share_mode",id:2},{rule:"optional",type:"float",name:"lr_mult",id:3,options:{"default":1}},{rule:"optional",type:"float",name:"decay_mult",id:4,options:{"default":1}}],enums:[{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"repeated",type:"string",name:"bottom",id:3},{rule:"repeated",type:"string",name:"top",id:4},{rule:"optional",type:"Phase",name:"phase",id:10},{rule:"repeated",type:"float",name:"loss_weight",id:5},{rule:"repeated",type:"ParamSpec",name:"param",id:6},{rule:"repeated",type:"BlobProto",name:"blobs",id:7},{rule:"repeated",type:"bool",name:"propagate_down",id:11},{rule:"repeated",type:"NetStateRule",name:"include",id:8},{rule:"repeated",type:"NetStateRule",name:"exclude",id:9},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:100},{rule:"optional",type:"LossParameter",name:"loss_param",id:101},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:102},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:103},{rule:"optional",type:"BatchNormParameter",name:"batch_norm_param",id:139},{rule:"optional",type:"BiasParameter",name:"bias_param",id:141},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:104},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:105},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:106},{rule:"optional",type:"CropParameter",name:"crop_param",id:144},{rule:"optional",type:"DataParameter",name:"data_param",id:107},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:108},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:109},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:110},{rule:"optional",type:"ELUParameter",name:"elu_param",id:140},{rule:"optional",type:"EmbedParameter",name:"embed_param",id:137},{rule:"optional",type:"ExpParameter",name:"exp_param",id:111},{rule:"optional",type:"FlattenParameter",name:"flatten_param",id:135},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:112},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:113},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:114},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:115},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:116},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:117},{rule:"optional",type:"InputParameter",name:"input_param",id:143},{rule:"optional",type:"LogParameter",name:"log_param",id:134},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:118},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:119},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:120},{rule:"optional",type:"ParameterParameter",name:"parameter_param",id:145},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:121},{rule:"optional",type:"PowerParameter",name:"power_param",id:122},{rule:"optional",type:"PReLUParameter",name:"prelu_param",id:131},{rule:"optional",type:"PythonParameter",name:"python_param",id:130},{rule:"optional",type:"ReductionParameter",name:"reduction_param",id:136},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:123},{rule:"optional",type:"ReshapeParameter",name:"reshape_param",id:133},{rule:"optional",type:"ScaleParameter",name:"scale_param",id:142},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:124},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:125},{rule:"optional",type:"SPPParameter",name:"spp_param",id:132},{rule:"optional",type:"SliceParameter",name:"slice_param",id:126},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:127},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:128},{rule:"optional",type:"TileParameter",name:"tile_param",id:138},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:129}]},{name:"TransformationParameter",fields:[{rule:"optional",type:"float",name:"scale",id:1,options:{"default":1}},{rule:"optional",type:"bool",name:"mirror",id:2,options:{"default":!1}},{rule:"optional",type:"uint32",name:"crop_size",id:3,options:{"default":0}},{rule:"optional",type:"string",name:"mean_file",id:4},{rule:"repeated",type:"float",name:"mean_value",id:5},{rule:"optional",type:"bool",name:"force_color",id:6,options:{"default":!1}},{rule:"optional",type:"bool",name:"force_gray",id:7,options:{"default":!1}}]},{name:"LossParameter",fields:[{rule:"optional",type:"int32",name:"ignore_label",id:1},{rule:"optional",type:"NormalizationMode",name:"normalization",id:3,options:{"default":"VALID"}},{rule:"optional",type:"bool",name:"normalize",id:2}],enums:[{name:"NormalizationMode",values:[{name:"FULL",id:0},{name:"VALID",id:1},{name:"BATCH_SIZE",id:2},{name:"NONE",id:3}]}]},{name:"AccuracyParameter",fields:[{rule:"optional",type:"uint32",name:"top_k",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}},{rule:"optional",type:"int32",name:"ignore_label",id:3}]},{name:"ArgMaxParameter",fields:[{rule:"optional",type:"bool",name:"out_max_val",id:1,options:{"default":!1}},{rule:"optional",type:"uint32",name:"top_k",id:2,options:{"default":1}},{rule:"optional",type:"int32",name:"axis",id:3}]},{name:"ConcatParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}},{rule:"optional",type:"uint32",name:"concat_dim",id:1,options:{"default":1}}]},{name:"BatchNormParameter",fields:[{rule:"optional",type:"bool",name:"use_global_stats",id:1},{rule:"optional",type:"float",name:"moving_average_fraction",id:2,options:{"default":.999}},{rule:"optional",type:"float",name:"eps",id:3,options:{"default":1e-5}}]},{name:"BiasParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3}]},{name:"ContrastiveLossParameter",fields:[{rule:"optional",type:"float",name:"margin",id:1,options:{"default":1}},{rule:"optional",type:"bool",name:"legacy_version",id:2,options:{"default":!1}}]},{name:"ConvolutionParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{"default":!0}},{rule:"repeated",type:"uint32",name:"pad",id:3},{rule:"repeated",type:"uint32",name:"kernel_size",id:4},{rule:"repeated",type:"uint32",name:"stride",id:6},{rule:"repeated",type:"uint32",name:"dilation",id:18},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernel_h",id:11},{rule:"optional",type:"uint32",name:"kernel_w",id:12},{rule:"optional",type:"uint32",name:"stride_h",id:13},{rule:"optional",type:"uint32",name:"stride_w",id:14},{rule:"optional",type:"uint32",name:"group",id:5,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:7},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:8},{rule:"optional",type:"Engine",name:"engine",id:15,options:{"default":"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:16,options:{"default":1}},{rule:"optional",type:"bool",name:"force_nd_im2col",id:17,options:{"default":!1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"CropParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":2}},{rule:"repeated",type:"uint32",name:"offset",id:2}]},{name:"DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{"default":0}},{rule:"optional",type:"DB",name:"backend",id:8,options:{"default":"LEVELDB"}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"bool",name:"force_encoded_color",id:9,options:{"default":!1}},{rule:"optional",type:"uint32",name:"prefetch",id:10,options:{"default":4}}],enums:[{name:"DB",values:[{name:"LEVELDB",id:0},{name:"LMDB",id:1}]}]},{name:"DropoutParameter",fields:[{rule:"optional",type:"float",name:"dropout_ratio",id:1,options:{"default":.5}}]},{name:"DummyDataParameter",fields:[{rule:"repeated",type:"FillerParameter",name:"data_filler",id:1},{rule:"repeated",type:"BlobShape",name:"shape",id:6},{rule:"repeated",type:"uint32",name:"num",id:2},{rule:"repeated",type:"uint32",name:"channels",id:3},{rule:"repeated",type:"uint32",name:"height",id:4},{rule:"repeated",type:"uint32",name:"width",id:5}]},{name:"EltwiseParameter",fields:[{rule:"optional",type:"EltwiseOp",name:"operation",id:1,options:{"default":"SUM"}},{rule:"repeated",type:"float",name:"coeff",id:2},{rule:"optional",type:"bool",name:"stable_prod_grad",id:3,options:{"default":!0}}],enums:[{name:"EltwiseOp",values:[{name:"PROD",id:0},{name:"SUM",id:1},{name:"MAX",id:2}]}]},{name:"ELUParameter",fields:[{rule:"optional",type:"float",name:"alpha",id:1,options:{"default":1}}]},{name:"EmbedParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"uint32",name:"input_dim",id:2},{rule:"optional",type:"bool",name:"bias_term",id:3,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:4},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"ExpParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{"default":-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"FlattenParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"end_axis",id:2,options:{"default":-1}}]},{name:"HDF5DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:2},{rule:"optional",type:"bool",name:"shuffle",id:3,options:{"default":!1}}]},{name:"HDF5OutputParameter",fields:[{rule:"optional",type:"string",name:"file_name",id:1}]},{name:"HingeLossParameter",fields:[{rule:"optional",type:"Norm",name:"norm",id:1,options:{"default":"L1"}}],enums:[{name:"Norm",values:[{name:"L1",id:1},{name:"L2",id:2}]}]},{name:"ImageDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4,options:{"default":1}},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{"default":0}},{rule:"optional",type:"bool",name:"shuffle",id:8,options:{"default":!1}},{rule:"optional",type:"uint32",name:"new_height",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"new_width",id:10,options:{"default":0}},{rule:"optional",type:"bool",name:"is_color",id:11,options:{"default":!0}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"string",name:"root_folder",id:12,options:{"default":""}}]},{name:"InfogainLossParameter",fields:[{rule:"optional",type:"string",name:"source",id:1}]},{name:"InnerProductParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:3},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:4},{rule:"optional",type:"int32",name:"axis",id:5,options:{"default":1}},{rule:"optional",type:"bool",name:"transpose",id:6,options:{"default":!1}}]},{name:"InputParameter",fields:[{rule:"repeated",type:"BlobShape",name:"shape",id:1}]},{name:"LogParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{"default":-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"LRNParameter",fields:[{rule:"optional",type:"uint32",name:"local_size",id:1,options:{"default":5}},{rule:"optional",type:"float",name:"alpha",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"beta",id:3,options:{"default":.75}},{rule:"optional",type:"NormRegion",name:"norm_region",id:4,options:{"default":"ACROSS_CHANNELS"}},{rule:"optional",type:"float",name:"k",id:5,options:{"default":1}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{"default":"DEFAULT"}}],enums:[{name:"NormRegion",values:[{name:"ACROSS_CHANNELS",id:0},{name:"WITHIN_CHANNEL",id:1}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"MemoryDataParameter",fields:[{rule:"optional",type:"uint32",name:"batch_size",id:1},{rule:"optional",type:"uint32",name:"channels",id:2},{rule:"optional",type:"uint32",name:"height",id:3},{rule:"optional",type:"uint32",name:"width",id:4}]},{name:"MVNParameter",fields:[{rule:"optional",type:"bool",name:"normalize_variance",id:1,options:{"default":!0}},{rule:"optional",type:"bool",name:"across_channels",id:2,options:{"default":!1}},{rule:"optional",type:"float",name:"eps",id:3,options:{"default":1e-9}}]},{name:"ParameterParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1}]},{name:"PoolingParameter",fields:[{rule:"optional",type:"PoolMethod",name:"pool",id:1,options:{"default":"MAX"}},{rule:"optional",type:"uint32",name:"pad",id:4,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernel_size",id:2},{rule:"optional",type:"uint32",name:"kernel_h",id:5},{rule:"optional",type:"uint32",name:"kernel_w",id:6},{rule:"optional",type:"uint32",name:"stride",id:3,options:{"default":1}},{rule:"optional",type:"uint32",name:"stride_h",id:7},{rule:"optional",type:"uint32",name:"stride_w",id:8},{rule:"optional",type:"Engine",name:"engine",id:11,options:{"default":"DEFAULT"}},{rule:"optional",type:"bool",name:"global_pooling",id:12,options:{"default":!1}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"PowerParameter",fields:[{rule:"optional",type:"float",name:"power",id:1,options:{"default":1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"PythonParameter",fields:[{rule:"optional",type:"string",name:"module",id:1},{rule:"optional",type:"string",name:"layer",id:2},{rule:"optional",type:"string",name:"param_str",id:3,options:{"default":""}},{rule:"optional",type:"bool",name:"share_in_parallel",id:4,options:{"default":!1}}]},{name:"ReductionParameter",fields:[{rule:"optional",type:"ReductionOp",name:"operation",id:1,options:{"default":"SUM"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":0}},{rule:"optional",type:"float",name:"coeff",id:3,options:{"default":1}}],enums:[{name:"ReductionOp",values:[{name:"SUM",id:1},{name:"ASUM",id:2},{name:"SUMSQ",id:3},{name:"MEAN",id:4}]}]},{name:"ReLUParameter",fields:[{rule:"optional",type:"float",name:"negative_slope",id:1,options:{"default":0}},{rule:"optional",type:"Engine",name:"engine",id:2,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"ReshapeParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":0}},{rule:"optional",type:"int32",name:"num_axes",id:3,options:{"default":-1}}]},{name:"ScaleParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3},{rule:"optional",type:"bool",name:"bias_term",id:4,options:{"default":!1}},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"SigmoidParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"SliceParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:3,options:{"default":1}},{rule:"repeated",type:"uint32",name:"slice_point",id:2},{rule:"optional",type:"uint32",name:"slice_dim",id:1,options:{"default":1}}]},{name:"SoftmaxParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TanHParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",
id:1},{name:"CUDNN",id:2}]}]},{name:"TileParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"tiles",id:2}]},{name:"ThresholdParameter",fields:[{rule:"optional",type:"float",name:"threshold",id:1,options:{"default":0}}]},{name:"WindowDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"float",name:"fg_threshold",id:7,options:{"default":.5}},{rule:"optional",type:"float",name:"bg_threshold",id:8,options:{"default":.5}},{rule:"optional",type:"float",name:"fg_fraction",id:9,options:{"default":.25}},{rule:"optional",type:"uint32",name:"context_pad",id:10,options:{"default":0}},{rule:"optional",type:"string",name:"crop_mode",id:11,options:{"default":"warp"}},{rule:"optional",type:"bool",name:"cache_images",id:12,options:{"default":!1}},{rule:"optional",type:"string",name:"root_folder",id:13,options:{"default":""}}]},{name:"SPPParameter",fields:[{rule:"optional",type:"uint32",name:"pyramid_height",id:1},{rule:"optional",type:"PoolMethod",name:"pool",id:2,options:{"default":"MAX"}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{"default":"DEFAULT"}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"V1LayerParameter",fields:[{rule:"repeated",type:"string",name:"bottom",id:2},{rule:"repeated",type:"string",name:"top",id:3},{rule:"optional",type:"string",name:"name",id:4},{rule:"repeated",type:"NetStateRule",name:"include",id:32},{rule:"repeated",type:"NetStateRule",name:"exclude",id:33},{rule:"optional",type:"LayerType",name:"type",id:5},{rule:"repeated",type:"BlobProto",name:"blobs",id:6},{rule:"repeated",type:"string",name:"param",id:1001},{rule:"repeated",type:"DimCheckMode",name:"blob_share_mode",id:1002},{rule:"repeated",type:"float",name:"blobs_lr",id:7},{rule:"repeated",type:"float",name:"weight_decay",id:8},{rule:"repeated",type:"float",name:"loss_weight",id:35},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:27},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:23},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:9},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:40},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:10},{rule:"optional",type:"DataParameter",name:"data_param",id:11},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:12},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:26},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:24},{rule:"optional",type:"ExpParameter",name:"exp_param",id:41},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:13},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:14},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:29},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:15},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:16},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:17},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:18},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:22},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:34},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:19},{rule:"optional",type:"PowerParameter",name:"power_param",id:21},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:30},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:38},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:39},{rule:"optional",type:"SliceParameter",name:"slice_param",id:31},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:37},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:25},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:20},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:36},{rule:"optional",type:"LossParameter",name:"loss_param",id:42},{rule:"optional",type:"V0LayerParameter",name:"layer",id:1}],enums:[{name:"LayerType",values:[{name:"NONE",id:0},{name:"ABSVAL",id:35},{name:"ACCURACY",id:1},{name:"ARGMAX",id:30},{name:"BNLL",id:2},{name:"CONCAT",id:3},{name:"CONTRASTIVE_LOSS",id:37},{name:"CONVOLUTION",id:4},{name:"DATA",id:5},{name:"DECONVOLUTION",id:39},{name:"DROPOUT",id:6},{name:"DUMMY_DATA",id:32},{name:"EUCLIDEAN_LOSS",id:7},{name:"ELTWISE",id:25},{name:"EXP",id:38},{name:"FLATTEN",id:8},{name:"HDF5_DATA",id:9},{name:"HDF5_OUTPUT",id:10},{name:"HINGE_LOSS",id:28},{name:"IM2COL",id:11},{name:"IMAGE_DATA",id:12},{name:"INFOGAIN_LOSS",id:13},{name:"INNER_PRODUCT",id:14},{name:"LRN",id:15},{name:"MEMORY_DATA",id:29},{name:"MULTINOMIAL_LOGISTIC_LOSS",id:16},{name:"MVN",id:34},{name:"POOLING",id:17},{name:"POWER",id:26},{name:"RELU",id:18},{name:"SIGMOID",id:19},{name:"SIGMOID_CROSS_ENTROPY_LOSS",id:27},{name:"SILENCE",id:36},{name:"SOFTMAX",id:20},{name:"SOFTMAX_LOSS",id:21},{name:"SPLIT",id:22},{name:"SLICE",id:33},{name:"TANH",id:23},{name:"WINDOW_DATA",id:24},{name:"THRESHOLD",id:31}]},{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"V0LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"uint32",name:"num_output",id:3},{rule:"optional",type:"bool",name:"biasterm",id:4,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:5},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:6},{rule:"optional",type:"uint32",name:"pad",id:7,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernelsize",id:8},{rule:"optional",type:"uint32",name:"group",id:9,options:{"default":1}},{rule:"optional",type:"uint32",name:"stride",id:10,options:{"default":1}},{rule:"optional",type:"PoolMethod",name:"pool",id:11,options:{"default":"MAX"}},{rule:"optional",type:"float",name:"dropout_ratio",id:12,options:{"default":.5}},{rule:"optional",type:"uint32",name:"local_size",id:13,options:{"default":5}},{rule:"optional",type:"float",name:"alpha",id:14,options:{"default":1}},{rule:"optional",type:"float",name:"beta",id:15,options:{"default":.75}},{rule:"optional",type:"float",name:"k",id:22,options:{"default":1}},{rule:"optional",type:"string",name:"source",id:16},{rule:"optional",type:"float",name:"scale",id:17,options:{"default":1}},{rule:"optional",type:"string",name:"meanfile",id:18},{rule:"optional",type:"uint32",name:"batchsize",id:19},{rule:"optional",type:"uint32",name:"cropsize",id:20,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:21,options:{"default":!1}},{rule:"repeated",type:"BlobProto",name:"blobs",id:50},{rule:"repeated",type:"float",name:"blobs_lr",id:51},{rule:"repeated",type:"float",name:"weight_decay",id:52},{rule:"optional",type:"uint32",name:"rand_skip",id:53,options:{"default":0}},{rule:"optional",type:"float",name:"det_fg_threshold",id:54,options:{"default":.5}},{rule:"optional",type:"float",name:"det_bg_threshold",id:55,options:{"default":.5}},{rule:"optional",type:"float",name:"det_fg_fraction",id:56,options:{"default":.25}},{rule:"optional",type:"uint32",name:"det_context_pad",id:58,options:{"default":0}},{rule:"optional",type:"string",name:"det_crop_mode",id:59,options:{"default":"warp"}},{rule:"optional",type:"int32",name:"new_num",id:60,options:{"default":0}},{rule:"optional",type:"int32",name:"new_channels",id:61,options:{"default":0}},{rule:"optional",type:"int32",name:"new_height",id:62,options:{"default":0}},{rule:"optional",type:"int32",name:"new_width",id:63,options:{"default":0}},{rule:"optional",type:"bool",name:"shuffle_images",id:64,options:{"default":!1}},{rule:"optional",type:"uint32",name:"concat_dim",id:65,options:{"default":1}},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:1001}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]}]},{name:"PReLUParameter",fields:[{rule:"optional",type:"FillerParameter",name:"filler",id:1},{rule:"optional",type:"bool",name:"channel_shared",id:2,options:{"default":!1}}]}],enums:[{name:"Phase",values:[{name:"TRAIN",id:0},{name:"TEST",id:1}]}]}).build()}(Parser||(Parser={}));var Parser;!function(e){var t=function(){function e(){}return e.prototype.fetch=function(e){var t=new Request(e);return fetch(t).then(function(e){return e.text()})},e.prototype.parse=function(e){var t=this;return this.fetch(e).then(function(e){return t.parseString(e)})},e}();e.TextParser=t}(Parser||(Parser={}));var Parser;!function(e){var t=function(){function e(){}return e.prototype.fetch=function(e){var t=new Request(e);return fetch(t).then(function(e){return e.arrayBuffer()})},e.prototype.parse=function(e){var t=this;return this.fetch(e).then(function(e){return t.parseBuffer(e)})},e}();e.BinaryParser=t}(Parser||(Parser={}));var Parser;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.parseString=function(e){return this.parsePrototxt(e)},t.prototype.parsePrototxt=function(e,t){void 0===t&&(t=0);var a,i={};if(0==t)var o=/(?:^|\n)(\w+):\s"*([\w\/.]+)"*/gi,n=/(?:^|\n)(\w+)\s\{([\S\s]*?)\n\}/gi;else var r="(?:^|\\n)\\s{"+t+"}",p="(\\w+)",o=new RegExp(r+p+'\\s*:\\s*"*([\\w/.]+)"*',"gi"),n=new RegExp(r+p+"\\s*\\{\\s*\\n([\\s\\S]*?)\\n\\s{"+t+"}\\}","gi");for(;a=o.exec(e);){var p=a[1],l=a[2];void 0!==i[p]?Array.isArray(i[p])?i[p].push(l):(i[p]=[i[p]],i[p].push(l)):i[a[1]]=l}for(;a=n.exec(e);){var p=a[1],l=this.parsePrototxt(a[2],t+2);void 0!==i[p]?Array.isArray(i[p])?i[p].push(l):(i[p]=[i[p]],i[p].push(l)):i[p]=l}return i},t}(e.TextParser);e.PrototxtParser=t}(Parser||(Parser={}));var Parser;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.parseBuffer=function(e){var t=dcodeIO.ProtoBuf.newBuilder({})["import"]({"package":"caffe",messages:[{name:"BlobShape",fields:[{rule:"repeated",type:"int64",name:"dim",id:1,options:{packed:!0}}]},{name:"BlobProto",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:7},{rule:"repeated",type:"float",name:"data",id:5,options:{packed:!0}},{rule:"repeated",type:"float",name:"diff",id:6,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_data",id:8,options:{packed:!0}},{rule:"repeated",type:"double",name:"double_diff",id:9,options:{packed:!0}},{rule:"optional",type:"int32",name:"num",id:1,options:{"default":0}},{rule:"optional",type:"int32",name:"channels",id:2,options:{"default":0}},{rule:"optional",type:"int32",name:"height",id:3,options:{"default":0}},{rule:"optional",type:"int32",name:"width",id:4,options:{"default":0}}]},{name:"BlobProtoVector",fields:[{rule:"repeated",type:"BlobProto",name:"blobs",id:1}]},{name:"Datum",fields:[{rule:"optional",type:"int32",name:"channels",id:1},{rule:"optional",type:"int32",name:"height",id:2},{rule:"optional",type:"int32",name:"width",id:3},{rule:"optional",type:"bytes",name:"data",id:4},{rule:"optional",type:"int32",name:"label",id:5},{rule:"repeated",type:"float",name:"float_data",id:6},{rule:"optional",type:"bool",name:"encoded",id:7,options:{"default":!1}}]},{name:"FillerParameter",fields:[{rule:"optional",type:"string",name:"type",id:1,options:{"default":"constant"}},{rule:"optional",type:"float",name:"value",id:2,options:{"default":0}},{rule:"optional",type:"float",name:"min",id:3,options:{"default":0}},{rule:"optional",type:"float",name:"max",id:4,options:{"default":1}},{rule:"optional",type:"float",name:"mean",id:5,options:{"default":0}},{rule:"optional",type:"float",name:"std",id:6,options:{"default":1}},{rule:"optional",type:"int32",name:"sparse",id:7,options:{"default":-1}},{rule:"optional",type:"VarianceNorm",name:"variance_norm",id:8,options:{"default":"FAN_IN"}}],enums:[{name:"VarianceNorm",values:[{name:"FAN_IN",id:0},{name:"FAN_OUT",id:1},{name:"AVERAGE",id:2}]}]},{name:"NetParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"repeated",type:"string",name:"input",id:3},{rule:"repeated",type:"BlobShape",name:"input_shape",id:8},{rule:"repeated",type:"int32",name:"input_dim",id:4},{rule:"optional",type:"bool",name:"force_backward",id:5,options:{"default":!1}},{rule:"optional",type:"NetState",name:"state",id:6},{rule:"optional",type:"bool",name:"debug_info",id:7,options:{"default":!1}},{rule:"repeated",type:"LayerParameter",name:"layer",id:100},{rule:"repeated",type:"V1LayerParameter",name:"layers",id:2}]},{name:"SolverParameter",fields:[{rule:"optional",type:"string",name:"net",id:24},{rule:"optional",type:"NetParameter",name:"net_param",id:25},{rule:"optional",type:"string",name:"train_net",id:1},{rule:"repeated",type:"string",name:"test_net",id:2},{rule:"optional",type:"NetParameter",name:"train_net_param",id:21},{rule:"repeated",type:"NetParameter",name:"test_net_param",id:22},{rule:"optional",type:"NetState",name:"train_state",id:26},{rule:"repeated",type:"NetState",name:"test_state",id:27},{rule:"repeated",type:"int32",name:"test_iter",id:3},{rule:"optional",type:"int32",name:"test_interval",id:4,options:{"default":0}},{rule:"optional",type:"bool",name:"test_compute_loss",id:19,options:{"default":!1}},{rule:"optional",type:"bool",name:"test_initialization",id:32,options:{"default":!0}},{rule:"optional",type:"float",name:"base_lr",id:5},{rule:"optional",type:"int32",name:"display",id:6},{rule:"optional",type:"int32",name:"average_loss",id:33,options:{"default":1}},{rule:"optional",type:"int32",name:"max_iter",id:7},{rule:"optional",type:"int32",name:"iter_size",id:36,options:{"default":1}},{rule:"optional",type:"string",name:"lr_policy",id:8},{rule:"optional",type:"float",name:"gamma",id:9},{rule:"optional",type:"float",name:"power",id:10},{rule:"optional",type:"float",name:"momentum",id:11},{rule:"optional",type:"float",name:"weight_decay",id:12},{rule:"optional",type:"string",name:"regularization_type",id:29,options:{"default":"L2"}},{rule:"optional",type:"int32",name:"stepsize",id:13},{rule:"repeated",type:"int32",name:"stepvalue",id:34},{rule:"optional",type:"float",name:"clip_gradients",id:35,options:{"default":-1}},{rule:"optional",type:"int32",name:"snapshot",id:14,options:{"default":0}},{rule:"optional",type:"string",name:"snapshot_prefix",id:15},{rule:"optional",type:"bool",name:"snapshot_diff",id:16,options:{"default":!1}},{rule:"optional",type:"SnapshotFormat",name:"snapshot_format",id:37,options:{"default":"BINARYPROTO"}},{rule:"optional",type:"SolverMode",name:"solver_mode",id:17,options:{"default":"GPU"}},{rule:"optional",type:"int32",name:"device_id",id:18,options:{"default":0}},{rule:"optional",type:"int64",name:"random_seed",id:20,options:{"default":-1}},{rule:"optional",type:"string",name:"type",id:40,options:{"default":"SGD"}},{rule:"optional",type:"float",name:"delta",id:31,options:{"default":1e-8}},{rule:"optional",type:"float",name:"momentum2",id:39,options:{"default":.999}},{rule:"optional",type:"float",name:"rms_decay",id:38},{rule:"optional",type:"bool",name:"debug_info",id:23,options:{"default":!1}},{rule:"optional",type:"bool",name:"snapshot_after_train",id:28,options:{"default":!0}},{rule:"optional",type:"SolverType",name:"solver_type",id:30,options:{"default":"SGD"}}],enums:[{name:"SnapshotFormat",values:[{name:"HDF5",id:0},{name:"BINARYPROTO",id:1}]},{name:"SolverMode",values:[{name:"CPU",id:0},{name:"GPU",id:1}]},{name:"SolverType",values:[{name:"SGD",id:0},{name:"NESTEROV",id:1},{name:"ADAGRAD",id:2},{name:"RMSPROP",id:3},{name:"ADADELTA",id:4},{name:"ADAM",id:5}]}]},{name:"SolverState",fields:[{rule:"optional",type:"int32",name:"iter",id:1},{rule:"optional",type:"string",name:"learned_net",id:2},{rule:"repeated",type:"BlobProto",name:"history",id:3},{rule:"optional",type:"int32",name:"current_step",id:4,options:{"default":0}}]},{name:"NetState",fields:[{rule:"optional",type:"Phase",name:"phase",id:1,options:{"default":"TEST"}},{rule:"optional",type:"int32",name:"level",id:2,options:{"default":0}},{rule:"repeated",type:"string",name:"stage",id:3}]},{name:"NetStateRule",fields:[{rule:"optional",type:"Phase",name:"phase",id:1},{rule:"optional",type:"int32",name:"min_level",id:2},{rule:"optional",type:"int32",name:"max_level",id:3},{rule:"repeated",type:"string",name:"stage",id:4},{rule:"repeated",type:"string",name:"not_stage",id:5}]},{name:"ParamSpec",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"DimCheckMode",name:"share_mode",id:2},{rule:"optional",type:"float",name:"lr_mult",id:3,options:{"default":1}},{rule:"optional",type:"float",name:"decay_mult",id:4,options:{"default":1}}],enums:[{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"repeated",type:"string",name:"bottom",id:3},{rule:"repeated",type:"string",name:"top",id:4},{rule:"optional",type:"Phase",name:"phase",id:10},{rule:"repeated",type:"float",name:"loss_weight",id:5},{rule:"repeated",type:"ParamSpec",name:"param",id:6},{rule:"repeated",type:"BlobProto",name:"blobs",id:7},{rule:"repeated",type:"bool",name:"propagate_down",id:11},{rule:"repeated",type:"NetStateRule",name:"include",id:8},{rule:"repeated",type:"NetStateRule",name:"exclude",id:9},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:100},{rule:"optional",type:"LossParameter",name:"loss_param",id:101},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:102},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:103},{rule:"optional",type:"BatchNormParameter",name:"batch_norm_param",id:139},{rule:"optional",type:"BiasParameter",name:"bias_param",id:141},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:104},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:105},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:106},{rule:"optional",type:"CropParameter",name:"crop_param",id:144},{rule:"optional",type:"DataParameter",name:"data_param",id:107},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:108},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:109},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:110},{rule:"optional",type:"ELUParameter",name:"elu_param",id:140},{rule:"optional",type:"EmbedParameter",name:"embed_param",id:137},{rule:"optional",type:"ExpParameter",name:"exp_param",id:111},{rule:"optional",type:"FlattenParameter",name:"flatten_param",id:135},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:112},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:113},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:114},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:115},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:116},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:117},{rule:"optional",type:"InputParameter",name:"input_param",id:143},{rule:"optional",type:"LogParameter",name:"log_param",id:134},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:118},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:119},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:120},{rule:"optional",type:"ParameterParameter",name:"parameter_param",id:145},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:121},{rule:"optional",type:"PowerParameter",name:"power_param",id:122},{rule:"optional",type:"PReLUParameter",name:"prelu_param",id:131},{rule:"optional",type:"PythonParameter",name:"python_param",id:130},{rule:"optional",type:"ReductionParameter",name:"reduction_param",id:136},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:123},{rule:"optional",type:"ReshapeParameter",name:"reshape_param",id:133},{rule:"optional",type:"ScaleParameter",name:"scale_param",id:142},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:124},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:125},{rule:"optional",type:"SPPParameter",name:"spp_param",id:132},{rule:"optional",type:"SliceParameter",name:"slice_param",id:126},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:127},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:128},{rule:"optional",type:"TileParameter",name:"tile_param",id:138},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:129}]},{name:"TransformationParameter",fields:[{rule:"optional",type:"float",name:"scale",id:1,options:{"default":1}},{rule:"optional",type:"bool",name:"mirror",id:2,options:{"default":!1}},{rule:"optional",type:"uint32",name:"crop_size",id:3,options:{"default":0}},{rule:"optional",type:"string",name:"mean_file",id:4},{rule:"repeated",type:"float",name:"mean_value",id:5},{rule:"optional",type:"bool",name:"force_color",id:6,options:{"default":!1}},{rule:"optional",type:"bool",name:"force_gray",id:7,options:{"default":!1}}]},{name:"LossParameter",fields:[{rule:"optional",type:"int32",name:"ignore_label",id:1},{rule:"optional",type:"NormalizationMode",name:"normalization",id:3,options:{"default":"VALID"}},{rule:"optional",type:"bool",name:"normalize",id:2}],enums:[{name:"NormalizationMode",values:[{name:"FULL",id:0},{name:"VALID",id:1},{name:"BATCH_SIZE",id:2},{name:"NONE",id:3}]}]},{name:"AccuracyParameter",fields:[{rule:"optional",type:"uint32",name:"top_k",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}},{rule:"optional",type:"int32",name:"ignore_label",id:3}]},{name:"ArgMaxParameter",fields:[{rule:"optional",type:"bool",name:"out_max_val",id:1,options:{"default":!1}},{rule:"optional",type:"uint32",name:"top_k",id:2,options:{"default":1}},{rule:"optional",type:"int32",name:"axis",id:3}]},{name:"ConcatParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}},{rule:"optional",type:"uint32",name:"concat_dim",id:1,options:{"default":1}}]},{name:"BatchNormParameter",fields:[{rule:"optional",type:"bool",name:"use_global_stats",id:1},{rule:"optional",type:"float",name:"moving_average_fraction",id:2,options:{"default":.999}},{rule:"optional",type:"float",name:"eps",id:3,options:{"default":1e-5}}]},{name:"BiasParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3}]},{name:"ContrastiveLossParameter",fields:[{rule:"optional",type:"float",name:"margin",id:1,options:{"default":1}},{rule:"optional",type:"bool",name:"legacy_version",id:2,options:{"default":!1}}]},{name:"ConvolutionParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{"default":!0}},{rule:"repeated",type:"uint32",name:"pad",id:3},{rule:"repeated",type:"uint32",name:"kernel_size",id:4},{rule:"repeated",type:"uint32",name:"stride",id:6},{rule:"repeated",type:"uint32",name:"dilation",id:18},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernel_h",id:11},{rule:"optional",type:"uint32",name:"kernel_w",id:12},{rule:"optional",type:"uint32",name:"stride_h",id:13},{rule:"optional",type:"uint32",name:"stride_w",id:14},{rule:"optional",type:"uint32",name:"group",id:5,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:7},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:8},{rule:"optional",type:"Engine",name:"engine",id:15,options:{"default":"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:16,options:{"default":1}},{rule:"optional",type:"bool",name:"force_nd_im2col",id:17,options:{"default":!1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"CropParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":2}},{rule:"repeated",type:"uint32",name:"offset",id:2}]},{name:"DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{"default":0}},{rule:"optional",type:"DB",name:"backend",id:8,options:{"default":"LEVELDB"}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"bool",name:"force_encoded_color",id:9,options:{"default":!1}},{rule:"optional",type:"uint32",name:"prefetch",id:10,options:{"default":4}}],enums:[{name:"DB",values:[{name:"LEVELDB",id:0},{name:"LMDB",id:1}]}]},{name:"DropoutParameter",fields:[{rule:"optional",type:"float",name:"dropout_ratio",id:1,options:{"default":.5}}]},{name:"DummyDataParameter",fields:[{rule:"repeated",type:"FillerParameter",name:"data_filler",id:1},{rule:"repeated",type:"BlobShape",name:"shape",id:6},{rule:"repeated",type:"uint32",name:"num",id:2},{rule:"repeated",type:"uint32",name:"channels",id:3},{rule:"repeated",type:"uint32",name:"height",id:4},{rule:"repeated",type:"uint32",name:"width",id:5}]},{name:"EltwiseParameter",fields:[{rule:"optional",type:"EltwiseOp",name:"operation",id:1,options:{"default":"SUM"}},{rule:"repeated",type:"float",name:"coeff",id:2},{rule:"optional",type:"bool",name:"stable_prod_grad",id:3,options:{"default":!0}}],enums:[{name:"EltwiseOp",values:[{name:"PROD",id:0},{name:"SUM",id:1},{name:"MAX",id:2}]}]},{name:"ELUParameter",fields:[{rule:"optional",type:"float",name:"alpha",id:1,options:{"default":1}}]},{name:"EmbedParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"uint32",name:"input_dim",id:2},{rule:"optional",type:"bool",name:"bias_term",id:3,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:4},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"ExpParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{"default":-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"FlattenParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"end_axis",id:2,options:{"default":-1}}]},{name:"HDF5DataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:2},{rule:"optional",type:"bool",name:"shuffle",id:3,options:{"default":!1}}]},{name:"HDF5OutputParameter",fields:[{rule:"optional",type:"string",name:"file_name",id:1}]},{name:"HingeLossParameter",fields:[{rule:"optional",type:"Norm",name:"norm",id:1,options:{"default":"L1"}}],enums:[{name:"Norm",values:[{name:"L1",id:1},{name:"L2",id:2}]}]},{name:"ImageDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"uint32",name:"batch_size",id:4,options:{"default":1}},{rule:"optional",type:"uint32",name:"rand_skip",id:7,options:{"default":0}},{rule:"optional",type:"bool",name:"shuffle",id:8,options:{"default":!1}},{rule:"optional",type:"uint32",name:"new_height",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"new_width",id:10,options:{"default":0}},{rule:"optional",type:"bool",name:"is_color",id:11,options:{"default":!0}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"string",name:"root_folder",id:12,options:{"default":""}}]},{name:"InfogainLossParameter",fields:[{rule:"optional",type:"string",name:"source",id:1}]},{name:"InnerProductParameter",fields:[{rule:"optional",type:"uint32",name:"num_output",id:1},{rule:"optional",type:"bool",name:"bias_term",id:2,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:3},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:4},{rule:"optional",type:"int32",name:"axis",id:5,options:{"default":1}},{rule:"optional",type:"bool",name:"transpose",id:6,options:{"default":!1}}]},{name:"InputParameter",fields:[{rule:"repeated",type:"BlobShape",name:"shape",id:1}]},{name:"LogParameter",fields:[{rule:"optional",type:"float",name:"base",id:1,options:{"default":-1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"LRNParameter",fields:[{rule:"optional",type:"uint32",name:"local_size",id:1,options:{"default":5}},{rule:"optional",type:"float",name:"alpha",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"beta",id:3,options:{"default":.75}},{rule:"optional",type:"NormRegion",name:"norm_region",id:4,options:{"default":"ACROSS_CHANNELS"}},{rule:"optional",type:"float",name:"k",id:5,options:{"default":1}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{"default":"DEFAULT"}}],enums:[{name:"NormRegion",values:[{name:"ACROSS_CHANNELS",id:0},{name:"WITHIN_CHANNEL",id:1}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"MemoryDataParameter",fields:[{rule:"optional",type:"uint32",name:"batch_size",id:1},{rule:"optional",type:"uint32",name:"channels",id:2},{rule:"optional",type:"uint32",name:"height",id:3},{rule:"optional",type:"uint32",name:"width",id:4}]},{name:"MVNParameter",fields:[{rule:"optional",type:"bool",name:"normalize_variance",id:1,options:{"default":!0}},{rule:"optional",type:"bool",name:"across_channels",id:2,options:{"default":!1}},{rule:"optional",type:"float",name:"eps",id:3,options:{"default":1e-9}}]},{name:"ParameterParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1}]},{name:"PoolingParameter",fields:[{rule:"optional",type:"PoolMethod",name:"pool",id:1,options:{"default":"MAX"}},{rule:"optional",type:"uint32",name:"pad",id:4,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_h",id:9,options:{"default":0}},{rule:"optional",type:"uint32",name:"pad_w",id:10,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernel_size",id:2},{rule:"optional",type:"uint32",name:"kernel_h",id:5},{rule:"optional",type:"uint32",name:"kernel_w",id:6},{rule:"optional",type:"uint32",name:"stride",id:3,options:{"default":1}},{rule:"optional",type:"uint32",name:"stride_h",id:7},{rule:"optional",type:"uint32",name:"stride_w",id:8},{rule:"optional",type:"Engine",name:"engine",id:11,options:{"default":"DEFAULT"}},{rule:"optional",type:"bool",name:"global_pooling",id:12,options:{"default":!1}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"PowerParameter",fields:[{rule:"optional",type:"float",name:"power",id:1,options:{"default":1}},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"float",name:"shift",id:3,options:{"default":0}}]},{name:"PythonParameter",fields:[{rule:"optional",type:"string",name:"module",id:1},{rule:"optional",
type:"string",name:"layer",id:2},{rule:"optional",type:"string",name:"param_str",id:3,options:{"default":""}},{rule:"optional",type:"bool",name:"share_in_parallel",id:4,options:{"default":!1}}]},{name:"ReductionParameter",fields:[{rule:"optional",type:"ReductionOp",name:"operation",id:1,options:{"default":"SUM"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":0}},{rule:"optional",type:"float",name:"coeff",id:3,options:{"default":1}}],enums:[{name:"ReductionOp",values:[{name:"SUM",id:1},{name:"ASUM",id:2},{name:"SUMSQ",id:3},{name:"MEAN",id:4}]}]},{name:"ReLUParameter",fields:[{rule:"optional",type:"float",name:"negative_slope",id:1,options:{"default":0}},{rule:"optional",type:"Engine",name:"engine",id:2,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"ReshapeParameter",fields:[{rule:"optional",type:"BlobShape",name:"shape",id:1},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":0}},{rule:"optional",type:"int32",name:"num_axes",id:3,options:{"default":-1}}]},{name:"ScaleParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"num_axes",id:2,options:{"default":1}},{rule:"optional",type:"FillerParameter",name:"filler",id:3},{rule:"optional",type:"bool",name:"bias_term",id:4,options:{"default":!1}},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:5}]},{name:"SigmoidParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"SliceParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:3,options:{"default":1}},{rule:"repeated",type:"uint32",name:"slice_point",id:2},{rule:"optional",type:"uint32",name:"slice_dim",id:1,options:{"default":1}}]},{name:"SoftmaxParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}},{rule:"optional",type:"int32",name:"axis",id:2,options:{"default":1}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TanHParameter",fields:[{rule:"optional",type:"Engine",name:"engine",id:1,options:{"default":"DEFAULT"}}],enums:[{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"TileParameter",fields:[{rule:"optional",type:"int32",name:"axis",id:1,options:{"default":1}},{rule:"optional",type:"int32",name:"tiles",id:2}]},{name:"ThresholdParameter",fields:[{rule:"optional",type:"float",name:"threshold",id:1,options:{"default":0}}]},{name:"WindowDataParameter",fields:[{rule:"optional",type:"string",name:"source",id:1},{rule:"optional",type:"float",name:"scale",id:2,options:{"default":1}},{rule:"optional",type:"string",name:"mean_file",id:3},{rule:"optional",type:"uint32",name:"batch_size",id:4},{rule:"optional",type:"uint32",name:"crop_size",id:5,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:6,options:{"default":!1}},{rule:"optional",type:"float",name:"fg_threshold",id:7,options:{"default":.5}},{rule:"optional",type:"float",name:"bg_threshold",id:8,options:{"default":.5}},{rule:"optional",type:"float",name:"fg_fraction",id:9,options:{"default":.25}},{rule:"optional",type:"uint32",name:"context_pad",id:10,options:{"default":0}},{rule:"optional",type:"string",name:"crop_mode",id:11,options:{"default":"warp"}},{rule:"optional",type:"bool",name:"cache_images",id:12,options:{"default":!1}},{rule:"optional",type:"string",name:"root_folder",id:13,options:{"default":""}}]},{name:"SPPParameter",fields:[{rule:"optional",type:"uint32",name:"pyramid_height",id:1},{rule:"optional",type:"PoolMethod",name:"pool",id:2,options:{"default":"MAX"}},{rule:"optional",type:"Engine",name:"engine",id:6,options:{"default":"DEFAULT"}}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]},{name:"Engine",values:[{name:"DEFAULT",id:0},{name:"CAFFE",id:1},{name:"CUDNN",id:2}]}]},{name:"V1LayerParameter",fields:[{rule:"repeated",type:"string",name:"bottom",id:2},{rule:"repeated",type:"string",name:"top",id:3},{rule:"optional",type:"string",name:"name",id:4},{rule:"repeated",type:"NetStateRule",name:"include",id:32},{rule:"repeated",type:"NetStateRule",name:"exclude",id:33},{rule:"optional",type:"LayerType",name:"type",id:5},{rule:"repeated",type:"BlobProto",name:"blobs",id:6},{rule:"repeated",type:"string",name:"param",id:1001},{rule:"repeated",type:"DimCheckMode",name:"blob_share_mode",id:1002},{rule:"repeated",type:"float",name:"blobs_lr",id:7},{rule:"repeated",type:"float",name:"weight_decay",id:8},{rule:"repeated",type:"float",name:"loss_weight",id:35},{rule:"optional",type:"AccuracyParameter",name:"accuracy_param",id:27},{rule:"optional",type:"ArgMaxParameter",name:"argmax_param",id:23},{rule:"optional",type:"ConcatParameter",name:"concat_param",id:9},{rule:"optional",type:"ContrastiveLossParameter",name:"contrastive_loss_param",id:40},{rule:"optional",type:"ConvolutionParameter",name:"convolution_param",id:10},{rule:"optional",type:"DataParameter",name:"data_param",id:11},{rule:"optional",type:"DropoutParameter",name:"dropout_param",id:12},{rule:"optional",type:"DummyDataParameter",name:"dummy_data_param",id:26},{rule:"optional",type:"EltwiseParameter",name:"eltwise_param",id:24},{rule:"optional",type:"ExpParameter",name:"exp_param",id:41},{rule:"optional",type:"HDF5DataParameter",name:"hdf5_data_param",id:13},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:14},{rule:"optional",type:"HingeLossParameter",name:"hinge_loss_param",id:29},{rule:"optional",type:"ImageDataParameter",name:"image_data_param",id:15},{rule:"optional",type:"InfogainLossParameter",name:"infogain_loss_param",id:16},{rule:"optional",type:"InnerProductParameter",name:"inner_product_param",id:17},{rule:"optional",type:"LRNParameter",name:"lrn_param",id:18},{rule:"optional",type:"MemoryDataParameter",name:"memory_data_param",id:22},{rule:"optional",type:"MVNParameter",name:"mvn_param",id:34},{rule:"optional",type:"PoolingParameter",name:"pooling_param",id:19},{rule:"optional",type:"PowerParameter",name:"power_param",id:21},{rule:"optional",type:"ReLUParameter",name:"relu_param",id:30},{rule:"optional",type:"SigmoidParameter",name:"sigmoid_param",id:38},{rule:"optional",type:"SoftmaxParameter",name:"softmax_param",id:39},{rule:"optional",type:"SliceParameter",name:"slice_param",id:31},{rule:"optional",type:"TanHParameter",name:"tanh_param",id:37},{rule:"optional",type:"ThresholdParameter",name:"threshold_param",id:25},{rule:"optional",type:"WindowDataParameter",name:"window_data_param",id:20},{rule:"optional",type:"TransformationParameter",name:"transform_param",id:36},{rule:"optional",type:"LossParameter",name:"loss_param",id:42},{rule:"optional",type:"V0LayerParameter",name:"layer",id:1}],enums:[{name:"LayerType",values:[{name:"NONE",id:0},{name:"ABSVAL",id:35},{name:"ACCURACY",id:1},{name:"ARGMAX",id:30},{name:"BNLL",id:2},{name:"CONCAT",id:3},{name:"CONTRASTIVE_LOSS",id:37},{name:"CONVOLUTION",id:4},{name:"DATA",id:5},{name:"DECONVOLUTION",id:39},{name:"DROPOUT",id:6},{name:"DUMMY_DATA",id:32},{name:"EUCLIDEAN_LOSS",id:7},{name:"ELTWISE",id:25},{name:"EXP",id:38},{name:"FLATTEN",id:8},{name:"HDF5_DATA",id:9},{name:"HDF5_OUTPUT",id:10},{name:"HINGE_LOSS",id:28},{name:"IM2COL",id:11},{name:"IMAGE_DATA",id:12},{name:"INFOGAIN_LOSS",id:13},{name:"INNER_PRODUCT",id:14},{name:"LRN",id:15},{name:"MEMORY_DATA",id:29},{name:"MULTINOMIAL_LOGISTIC_LOSS",id:16},{name:"MVN",id:34},{name:"POOLING",id:17},{name:"POWER",id:26},{name:"RELU",id:18},{name:"SIGMOID",id:19},{name:"SIGMOID_CROSS_ENTROPY_LOSS",id:27},{name:"SILENCE",id:36},{name:"SOFTMAX",id:20},{name:"SOFTMAX_LOSS",id:21},{name:"SPLIT",id:22},{name:"SLICE",id:33},{name:"TANH",id:23},{name:"WINDOW_DATA",id:24},{name:"THRESHOLD",id:31}]},{name:"DimCheckMode",values:[{name:"STRICT",id:0},{name:"PERMISSIVE",id:1}]}]},{name:"V0LayerParameter",fields:[{rule:"optional",type:"string",name:"name",id:1},{rule:"optional",type:"string",name:"type",id:2},{rule:"optional",type:"uint32",name:"num_output",id:3},{rule:"optional",type:"bool",name:"biasterm",id:4,options:{"default":!0}},{rule:"optional",type:"FillerParameter",name:"weight_filler",id:5},{rule:"optional",type:"FillerParameter",name:"bias_filler",id:6},{rule:"optional",type:"uint32",name:"pad",id:7,options:{"default":0}},{rule:"optional",type:"uint32",name:"kernelsize",id:8},{rule:"optional",type:"uint32",name:"group",id:9,options:{"default":1}},{rule:"optional",type:"uint32",name:"stride",id:10,options:{"default":1}},{rule:"optional",type:"PoolMethod",name:"pool",id:11,options:{"default":"MAX"}},{rule:"optional",type:"float",name:"dropout_ratio",id:12,options:{"default":.5}},{rule:"optional",type:"uint32",name:"local_size",id:13,options:{"default":5}},{rule:"optional",type:"float",name:"alpha",id:14,options:{"default":1}},{rule:"optional",type:"float",name:"beta",id:15,options:{"default":.75}},{rule:"optional",type:"float",name:"k",id:22,options:{"default":1}},{rule:"optional",type:"string",name:"source",id:16},{rule:"optional",type:"float",name:"scale",id:17,options:{"default":1}},{rule:"optional",type:"string",name:"meanfile",id:18},{rule:"optional",type:"uint32",name:"batchsize",id:19},{rule:"optional",type:"uint32",name:"cropsize",id:20,options:{"default":0}},{rule:"optional",type:"bool",name:"mirror",id:21,options:{"default":!1}},{rule:"repeated",type:"BlobProto",name:"blobs",id:50},{rule:"repeated",type:"float",name:"blobs_lr",id:51},{rule:"repeated",type:"float",name:"weight_decay",id:52},{rule:"optional",type:"uint32",name:"rand_skip",id:53,options:{"default":0}},{rule:"optional",type:"float",name:"det_fg_threshold",id:54,options:{"default":.5}},{rule:"optional",type:"float",name:"det_bg_threshold",id:55,options:{"default":.5}},{rule:"optional",type:"float",name:"det_fg_fraction",id:56,options:{"default":.25}},{rule:"optional",type:"uint32",name:"det_context_pad",id:58,options:{"default":0}},{rule:"optional",type:"string",name:"det_crop_mode",id:59,options:{"default":"warp"}},{rule:"optional",type:"int32",name:"new_num",id:60,options:{"default":0}},{rule:"optional",type:"int32",name:"new_channels",id:61,options:{"default":0}},{rule:"optional",type:"int32",name:"new_height",id:62,options:{"default":0}},{rule:"optional",type:"int32",name:"new_width",id:63,options:{"default":0}},{rule:"optional",type:"bool",name:"shuffle_images",id:64,options:{"default":!1}},{rule:"optional",type:"uint32",name:"concat_dim",id:65,options:{"default":1}},{rule:"optional",type:"HDF5OutputParameter",name:"hdf5_output_param",id:1001}],enums:[{name:"PoolMethod",values:[{name:"MAX",id:0},{name:"AVE",id:1},{name:"STOCHASTIC",id:2}]}]},{name:"PReLUParameter",fields:[{rule:"optional",type:"FillerParameter",name:"filler",id:1},{rule:"optional",type:"bool",name:"channel_shared",id:2,options:{"default":!1}}]}],enums:[{name:"Phase",values:[{name:"TRAIN",id:0},{name:"TEST",id:1}]}]}).build();return this.parseProto(e,t.caffe)},t}(e.BinaryParser);e.BinaryprotoParser=t}(Parser||(Parser={}));var Parser;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.parseProto=function(e,t){for(var a=t.BlobProto.decode(e),i=a.width,o=a.height,n=a.channels,r=a.data,p=new Net.Vol(i,o,n,0),l=0;l<n;l++)for(var s=0;s<o;s++)for(var d=0;d<i;d++){var u=(o*l+s)*i+d;p.set(d,s,l,r[u])}return p},t}(e.BinaryprotoParser);e.BlobProtoParser=t}(Parser||(Parser={}));var Net;!function(e){function t(e,t){for(var a=r.randf(0,1),i=0,o=0,n=e.length;o<n;o++)if(i+=t[o],a<i)return e[o]}function a(e,t,a){if(void 0===e&&(e={}),"string"==typeof t)return void 0!==e[t]?e[t]:a;var i=a;return t.forEach(function(t){i=void 0!==e[t]?e[t]:i}),i}function i(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}}function o(e,t){for(var a=0,i=e.length;a<i;a++)if(e[a]===t)return!0;return!1}function n(e){for(var t=[],a=0,i=e.length;a<i;a++)o(t,e[a])||t.push(e[a]);return t}var r=NumJS;e.weightedSample=t,e.getopt=a,e.assert=i,e.arrContains=o,e.arrUnique=n}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(){function e(e){this.in_depth=1,this.in_sy=1,this.in_sx=1,this.out_depth=1,this.out_sy=1,this.out_sx=1,this.name=void 0!==e.name?e.name:"",this.input=void 0!==e.input?e.input:void 0,this.output=void 0!==e.output?e.output:void 0,e.pred||(this.in_sx=e.in_sx,this.in_sy=e.in_sy,this.in_depth=e.in_depth)}return e.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=this.in_depth},e.prototype.resetGradient=function(){if(this.in_act instanceof Array)for(var e=0;e<this.in_act.length;e++)this.in_act[e].dw=t.zeros(this.in_act[e].w.length);else this.in_act.dw=t.zeros(this.in_act.w.length)},e.prototype.getNumParameters=function(){return[0,0]},e.prototype.getOutputShape=function(){return[this.in_depth,this.in_sy,this.in_sx]},e.prototype.getDescription=function(){return[this.layer_type.toUpperCase(),this.name]},e.prototype.getParamsAndGrads=function(){return[]},e.prototype.toJSON=function(){var e={};return e.out_depth=this.out_depth,e.out_sx=this.out_sx,e.out_sy=this.out_sy,e.layer_type=this.layer_type,e.name=this.name,e.output=this.output,e.input=this.input,e},e.prototype.fromJSON=function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.name=e.name,this.output=e.output,this.input=e.input},e}();e.BaseLayer=a}(Net||(Net={}));var Net;!function(e){var t=function(t){function a(a){t.call(this,a||{}),this.layer_type="input",this.in_depth=e.getopt(a,["in_depth","out_depth","depth"],0),this.in_sx=e.getopt(a,["in_sx","out_sx","sx","width"],1),this.in_sy=e.getopt(a,["in_sy","out_sy","sy","height"],1),this.updateDimensions()}return __extends(a,t),a.prototype.forward=function(e,t){return this.in_act=e,this.resetGradient(),this.out_act=e,this.out_act},a.prototype.backward=function(){},a}(e.BaseLayer);e.InputLayer=t}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(a){function i(t){a.call(this,t||{}),this.layer_type="concat",this.axis=e.getopt(t,["axis"],1),this.updateDimensions(t.pred)}return __extends(i,a),i.prototype.forward=function(t,a){this.in_act=t,this.resetGradient();var i=new e.Vol(this.out_sx,this.out_sy,this.out_depth,0),o=0;if(0===this.axis)for(var n=i.w,r=0;r<t.length;r++)n.set(t[r].w,o),o+=t[r].w.length;else for(var p=0;p<t.length;p++){for(var l=t[p],s=0;s<l.depth;s++)for(var d=0;d<l.sx;d++)for(var u=0;u<l.sy;u++)i.set(d,u,s+o,l.get(d,u,s));o+=l.depth}return this.out_act=i,this.out_act},i.prototype.backward=function(){var e=this.in_act,a=this.out_act,i=0;if(0===this.axis)for(var o=a.dw,n=0;n<e.length;n++){var r=e[n].dw;r=t.add(r,o.slice(i,i+r.length)),i+=r.length}else for(var n=0,p=e.length;n<p;++n){for(var l=e[n],r=e[n].dw,s=0,d=l.depth;s<d;++s)for(var u=0,m=l.sx;u<m;++u)for(var h=0,y=l.sy;h<y;++h)l.add_grad(u,h,s,a.get_grad(u,h,s+i));i+=l.depth}},i.prototype.updateDimensions=function(e){e&&(0==this.axis?(this.in_sx=e[0].in_sx,this.in_sy=e[0].in_sy,this.in_depth=e[0].in_depth):(this.in_sx=e[0].in_sx,this.in_sy=e[0].in_sy,this.in_depth=t.sum(e.map(function(e){return e.out_depth})))),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=this.in_depth},i.prototype.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.axis=this.axis,e},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.axis=e.axis},i}(e.BaseLayer);e.ConcatLayer=a}(Net||(Net={}));var Net;!function(e){var t=function(t){function a(a){t.call(this,a||{}),this.layer_type="conv",this.out_depth=a.filters,this.sx=a.sx,this.sy=e.getopt(a,["sy"],this.sx),this.stride=e.getopt(a,["stride"],1),this.pad=e.getopt(a,["pad"],0),this.l1_decay_mul=e.getopt(a,["l1_decay_mul"],0),this.l2_decay_mul=e.getopt(a,["l2_decay_mul"],1),this.updateDimensions(a.pred);var i=e.getopt(a,["bias_pref"],0);this.biases=new e.Vol(1,1,this.out_depth,i),this.filters=[];for(var o=0;o<this.out_depth;++o)this.filters.push(new e.Vol(this.sx,this.sy,this.in_depth,0))}return __extends(a,t),a.prototype.forward=function(t,a){this.in_act=t,this.resetGradient();for(var i=new e.Vol(0|this.out_sx,0|this.out_sy,0|this.out_depth,0),o=0|t.sx,n=0|t.sy,r=0|this.stride,p=0;p<this.out_depth;++p)for(var l=this.filters[p],s=0|-this.pad,d=0|-this.pad,u=0;u<this.out_sy;d+=r,++u){s=0|-this.pad;for(var m=0;m<this.out_sx;s+=r,++m){for(var h=0,y=0;y<l.sy;++y)for(var f=d+y,_=0;_<l.sx;++_){var c=s+_;if(f>=0&&f<n&&c>=0&&c<o)for(var g=0;g<l.depth;++g)h+=l.w[(l.sx*y+_)*l.depth+g]*t.w[(o*f+c)*t.depth+g]}h+=this.biases.w[p],i.set(m,u,p,h)}}return this.out_act=i,this.out_act},a.prototype.backward=function(){for(var e=this.in_act,t=0|e.sx,a=0|e.sy,i=0|this.stride,o=0;o<this.out_depth;++o)for(var n=this.filters[o],r=0|-this.pad,p=0|-this.pad,l=0;l<this.out_sy;p+=i,++l){r=0|-this.pad;for(var s=0;s<this.out_sx;r+=i,++s){for(var d=this.out_act.get_grad(s,l,o),u=0;u<n.sy;++u)for(var m=p+u,h=0;h<n.sx;++h){var y=r+h;if(m>=0&&m<a&&y>=0&&y<t)for(var f=0;f<n.depth;++f){var _=(t*m+y)*e.depth+f,c=(n.sx*u+h)*n.depth+f;n.dw[c]+=e.w[_]*d,e.dw[_]+=n.w[c]*d}}this.biases.dw[o]+=d}}},a.prototype.getParamsAndGrads=function(){for(var e=[],t=0;t<this.out_depth;t++)e.push({params:this.filters[t].w,grads:this.filters[t].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return e.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),e},a.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth);var t=this.getOutputShape();this.out_sx=t[1],this.out_sy=t[2]},a.prototype.getNumParameters=function(){return[this.in_depth*this.sx*this.sy*this.out_depth,this.out_depth]},a.prototype.getOutputShape=function(){return[this.out_depth,Math.round((this.in_sx+2*this.pad-this.sx)/this.stride+1),Math.round((this.in_sy+2*this.pad-this.sy)/this.stride+1)]},a.prototype.getDescription=function(){return t.prototype.getDescription.call(this).concat([[this.out_depth,this.sy,this.sx].join("x")+" Stride "+this.stride+" Pad "+this.pad])},a.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);e.sx=this.sx,e.sy=this.sy,e.stride=this.stride,e.in_depth=this.in_depth,e.l1_decay_mul=this.l1_decay_mul,e.l2_decay_mul=this.l2_decay_mul,e.pad=this.pad,e.filters=[];for(var a=0;a<this.filters.length;a++)e.filters.push(this.filters[a].toJSON());return e.biases=this.biases.toJSON(),e},a.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a),this.sx=a.sx,this.sy=a.sy,this.stride=a.stride,this.in_depth=a.in_depth,this.filters=[],this.l1_decay_mul=void 0!==a.l1_decay_mul?a.l1_decay_mul:0,this.l2_decay_mul=void 0!==a.l2_decay_mul?a.l2_decay_mul:1,this.pad=void 0!==a.pad?a.pad:0;for(var i=0;i<a.filters.length;i++)this.filters.push(e.Vol.fromJSON(a.filters[i]));this.biases=e.Vol.fromJSON(a.biases)},a}(e.BaseLayer);e.ConvLayer=t}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(a){function i(t){a.call(this,t||{}),this.layer_type="pool",this.out_depth=t.filters,this.sx=t.sx,this.pool=e.getopt(t,["pool"],"MAX"),this.sy=e.getopt(t,["sy"],this.sx),this.stride=e.getopt(t,["stride"],1),this.pad=e.getopt(t,["pad"],0),this.updateDimensions(t.pred)}return __extends(i,a),i.prototype.forward=function(a,i){this.in_act=a,this.resetGradient(),this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth);var o=new e.Vol(this.out_sx,this.out_sy,this.out_depth,0);if("AVE"===this.pool)for(var n=(this.sx*this.sy,0);n<this.out_depth;++n)for(var r=0;r<this.out_sx;++r)for(var p=0;p<this.out_sy;++p){var l=0,s=r*this.stride-this.pad,d=p*this.stride-this.pad,u=Math.min(s+this.sx,a.sx+this.pad),m=Math.min(d+this.sy,a.sy+this.pad);s=Math.max(s,0),d=Math.max(d,0),u=Math.min(u,a.sx),m=Math.min(m,a.sy);for(var h=(u-s)*(m-d),y=s;y<u;++y)for(var f=d;f<m;++f)l+=a.get(y,f,n);o.set(r,p,n,l/h)}else for(var _=0,c=0;c<this.out_depth;++c)for(var g=-this.pad,v=-this.pad,P=0;P<this.out_sx;g+=this.stride,P++){v=-this.pad;for(var w=0;w<this.out_sy;v+=this.stride,w++){for(var N=-99999,b=-1,S=-1,x=0;x<this.sx;++x)for(var A=0;A<this.sy;++A){var L=v+A,D=g+x;if(L>=0&&L<a.sy&&D>=0&&D<a.sx){var E=a.get(D,L,c);E>N&&(N=E,b=D,S=L)}}this.switchx[_]=b,this.switchy[_]=S,_++,o.set(P,w,c,N)}}return this.out_act=o,this.out_act},i.prototype.backward=function(){var e=this.in_act;this.out_act;if("AVE"===this.pool);else for(var t=0,a=0;a<this.out_depth;++a)for(var i=-this.pad,o=0;o<this.out_sx;i+=this.stride,o++)for(var n=-this.pad,r=0;r<this.out_sy;n+=this.stride,r++){var p=this.out_act.get_grad(o,r,a);e.add_grad(this.switchx[t],this.switchy[t],a,p),t++}},i.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth);var t=this.getOutputShape();this.out_sx=t[1],this.out_sy=t[2],this.out_depth=this.in_depth},i.prototype.getOutputShape=function(){return[this.out_depth,Math.ceil((this.in_sx+2*this.pad-this.sx)/this.stride+1),Math.ceil((this.in_sy+2*this.pad-this.sy)/this.stride+1)]},i.prototype.getDescription=function(){return[this.pool+" "+this.layer_type.toUpperCase(),this.name,[this.sy,this.sx].join("x")+" Stride "+this.stride+" Pad "+this.pad]},i.prototype.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.sx=this.sx,e.sy=this.sy,e.stride=this.stride,e.pool=this.pool,e.in_depth=this.in_depth,e.pad=this.pad,e},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.pool=void 0!==e.pool?e.pool:"MAX",this.sx=e.sx,this.sy=e.sy,this.stride=e.stride,this.in_depth=e.in_depth,this.pad=void 0!==e.pad?e.pad:0,this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array)},i}(e.BaseLayer);e.PoolLayer=a}(Net||(Net={}));var Net;!function(e){var t=function(t){function a(a){t.call(this,a||{}),this.layer_type="fc",this.sx=1,this.sy=1,this.out_depth=void 0!==a.num_neurons?a.num_neurons:a.filters,this.l1_decay_mul=e.getopt(a,["l1_decay_mul"],0),this.l2_decay_mul=e.getopt(a,["l2_decay_mul"],1),this.updateDimensions(a.pred);var i=e.getopt(a,["bias_pref"],0);this.biases=new e.Vol(1,1,this.out_depth,i),this.filters=[];for(var o=0;o<this.out_depth;++o)this.filters.push(new e.Vol(1,1,this.num_inputs,0));if(void 0!==a.filters)for(var o=0;o<this.out_depth;++o)this.filters[o].w.set(a.filters[o]);void 0!==a.biases&&this.biases.w.set(a.biases)}return __extends(a,t),a.prototype.forward=function(t,a){this.in_act=t,this.resetGradient();for(var i=new e.Vol(1,1,this.out_depth,0),o=t.w,n=0;n<this.out_depth;++n){for(var r=0,p=this.filters[n].w,l=0;l<this.num_inputs;++l)r+=o[l]*p[l];r+=this.biases.w[n],i.w[n]=r}return this.out_act=i,this.out_act},a.prototype.backward=function(){for(var e=this.in_act,t=0;t<this.out_depth;++t){for(var a=this.filters[t],i=this.out_act.dw[t],o=0;o<this.num_inputs;++o)e.dw[o]+=a.w[o]*i,a.dw[o]+=e.w[o]*i;this.biases.dw[t]+=i}},a.prototype.getParamsAndGrads=function(){for(var e=[],t=0;t<this.out_depth;++t)e.push({params:this.filters[t].w,grads:this.filters[t].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return e.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),e},a.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth},a.prototype.getNumParameters=function(){return[this.in_depth*this.in_sx*this.in_sy*this.out_depth,this.out_depth]},a.prototype.getOutputShape=function(){return[this.out_depth,1,1]},a.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);e.num_inputs=this.num_inputs,e.l1_decay_mul=this.l1_decay_mul,e.l2_decay_mul=this.l2_decay_mul,e.filters=[];for(var a=0;a<this.filters.length;a++)e.filters.push(this.filters[a].toJSON());return e.biases=this.biases.toJSON(),e},a.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a),this.num_inputs=a.num_inputs,this.l1_decay_mul=void 0!==a.l1_decay_mul?a.l1_decay_mul:1,this.l2_decay_mul=void 0!==a.l2_decay_mul?a.l2_decay_mul:1,this.filters=[];for(var i=0;i<a.filters.length;i++)this.filters.push(e.Vol.fromJSON(a.filters[i]));this.biases=e.Vol.fromJSON(a.biases)},a}(e.BaseLayer);e.FullyConnectedLayer=t}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(a){function i(t){a.call(this,t||{}),this.layer_type="dropout",this.drop_prob=e.getopt(t,["drop_prob"],.5),this.updateDimensions(t.pred)}return __extends(i,a),i.prototype.forward=function(e,a){void 0===a&&(a=!1),this.in_act=e,this.resetGradient(),this.dropped=t.zeros(this.out_sx*this.out_sy*this.out_depth,Int8Array);var i=e.clone(),o=e.w.length;if(a)for(var n=0;n<o;n++)Math.random()<this.drop_prob?(i.w[n]=0,this.dropped[n]=1):i.w[n]*=this.drop_prob;return this.out_act=i,this.out_act},i.prototype.backward=function(){for(var e=this.in_act,t=this.out_act,a=e.w.length,i=0;i<a;i++)1!==this.dropped[i]&&(e.dw[i]+=t.dw[i])},i.prototype.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.drop_prob=this.drop_prob,e},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.drop_prob=e.drop_prob},i}(e.BaseLayer);e.DropoutLayer=a}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(e){function a(t){e.call(this,t||{}),this.layer_type="tanh",this.updateDimensions(t.pred)}return __extends(a,e),a.prototype.forward=function(e,a){this.in_act=e,this.resetGradient();for(var i=e.cloneAndZero(),o=e.w.length,n=0;n<o;n++)i.w[n]=t.tanh(e.w[n]);return this.out_act=i,this.out_act},a.prototype.backward=function(){for(var e=this.in_act,t=this.out_act,a=e.w.length,i=0;i<a;i++){var o=t.w[i];e.dw[i]+=(1-o*o)*t.dw[i]}},a}(e.BaseLayer);e.TanhLayer=a}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="maxout",this.group_size=void 0!==e.group_size?e.group_size:2,this.updateDimensions(e.pred)}return __extends(i,a),i.prototype.forward=function(a,i){this.in_act=a,this.resetGradient(),this.switches=t.zeros(this.out_sx*this.out_sy*this.out_depth,Uint32Array);var o=this.out_depth,n=new e.Vol(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var r=0;r<o;r++){for(var p=r*this.group_size,l=a.w[p],s=0,d=1;d<this.group_size;d++){var u=a.w[p+d];u>l&&(l=u,s=d)}n.w[r]=l,this.switches[r]=p+s}else for(var m=0,h=0;h<a.sx;h++)for(var y=0;y<a.sy;y++)for(var r=0;r<o;r++){for(var p=r*this.group_size,l=a.get(h,y,p),s=0,d=1;d<this.group_size;d++){var u=a.get(h,y,p+d);u>l&&(l=u,s=d)}n.set(h,y,r,l),this.switches[m]=p+s,m++}return this.out_act=n,this.out_act},i.prototype.backward=function(){var e=this.in_act,t=this.out_act,a=this.out_depth;if(1===this.out_sx&&1===this.out_sy)for(var i=0;i<a;i++){var o=t.dw[i];e.dw[this.switches[i]]+=o}else for(var n=0,r=0;r<t.sx;r++)for(var p=0;p<t.sy;p++)for(var i=0;i<a;i++){var o=t.get_grad(r,p,i);e.add_grad(r,p,this.switches[n],o),n++}},i.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth),this.out_sx=this.in_sx,this.out_sy=this.in_sy,this.out_depth=Math.floor(this.in_depth/this.group_size)},i.prototype.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.group_size=this.group_size,e},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.group_size=e.group_size},i}(e.BaseLayer);e.MaxoutLayer=a}(Net||(Net={}));var Net;!function(e){var t=function(e){function t(t){e.call(this,t||{}),this.layer_type="relu",this.updateDimensions(t.pred)}return __extends(t,e),t.prototype.forward=function(e,t){this.in_act=e,this.resetGradient();for(var a=e.clone(),i=e.w.length,o=a.w,n=0;n<i;n++)o[n]<0&&(o[n]=0);return this.out_act=a,this.out_act},t.prototype.backward=function(){for(var e=this.in_act,t=this.out_act,a=e.w.length,i=0;i<a;i++)t.w[i]<=0?e.dw[i]=0:e.dw[i]+=t.dw[i]},t}(e.BaseLayer);e.ReluLayer=t}(Net||(Net={}));var Net;!function(e){var t=function(e){function t(t){e.call(this,t||{}),this.layer_type="sigmoid",this.updateDimensions(t.pred)}return __extends(t,e),t.prototype.forward=function(e,t){this.in_act=e,this.resetGradient();for(var a=e.cloneAndZero(),i=e.w.length,o=a.w,n=e.w,r=0;r<i;r++)o[r]=1/(1+Math.exp(-n[r]));return this.out_act=a,this.out_act},t.prototype.backward=function(){for(var e=this.in_act,t=this.out_act,a=e.w.length,i=0;i<a;i++){var o=t.w[i];e.dw[i]+=o*(1-o)*t.dw[i]}},t}(e.BaseLayer);e.SigmoidLayer=t}(Net||(Net={}));var Net;!function(e){var t=function(e){function t(t){e.call(this,t||{}),this.layer_type="regression",this.updateDimensions(t.pred)}return __extends(t,e),t.prototype.forward=function(e,t){return this.in_act=e,this.resetGradient(),this.out_act=e,e},t.prototype.backward=function(e){var t=this.in_act,a=0;if(e instanceof Float32Array)for(var i=0;i<this.out_depth;i++){var o=t.w[i]-e[i];t.dw[i]=o,a+=.5*o*o}else if("number"==typeof e){var o=t.w[0]-e;t.dw[0]=o,a+=.5*o*o}else{var i=e.dim,n=e.val,o=t.w[i]-n;t.dw[i]=o,a+=.5*o*o}return a},t.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},t.prototype.getOutputShape=function(){return[this.out_depth,1,1]},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.num_inputs=this.num_inputs,t},t.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.num_inputs=t.num_inputs},t}(e.BaseLayer);e.RegressionLayer=t}(Net||(Net={}));var Net;!function(e){var t=NumJS,a=function(a){function i(e){a.call(this,e||{}),this.layer_type="softmax",this.updateDimensions(e.pred)}return __extends(i,a),i.prototype.forward=function(a,i){this.in_act=a,this.resetGradient();for(var o=new e.Vol(1,1,this.out_depth,0),n=a.w,r=a.w[0],p=1;p<this.out_depth;p++)n[p]>r&&(r=n[p]);for(var l=t.zeros(this.out_depth),s=0,p=0;p<this.out_depth;p++){var d=Math.exp(n[p]-r);s+=d,l[p]=d}for(var p=0;p<this.out_depth;p++)l[p]/=s,o.w[p]=l[p];return this.es=l,this.out_act=o,this.out_act},i.prototype.backward=function(e){for(var t=this.in_act,a=0;a<this.out_depth;a++){var i=a===e?1:0,o=-(i-this.es[a]);t.dw[a]+=o}return-Math.log(this.es[e])},i.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},i.prototype.getOutputShape=function(){return[this.out_depth,1,1]},i.prototype.toJSON=function(){var e=a.prototype.toJSON.call(this);return e.num_inputs=this.num_inputs,e},i.prototype.fromJSON=function(e){a.prototype.fromJSON.call(this,e),this.num_inputs=e.num_inputs},i}(e.BaseLayer);e.SoftmaxLayer=a}(Net||(Net={}));var Net;!function(e){var t=function(e){function t(t){e.call(this,t||{}),this.layer_type="svm",this.updateDimensions(t.pred)}return __extends(t,e),t.prototype.forward=function(e,t){return this.in_act=e,this.resetGradient(),this.out_act=e,e},t.prototype.backward=function(e){for(var t=this.in_act,a=t.w[e],i=1,o=0,n=0;n<this.out_depth;n++)if(e!==n){var r=-a+t.w[n]+i;r>0&&(t.dw[n]+=1,t.dw[e]-=1,o+=r)}return o},t.prototype.updateDimensions=function(e){e&&(this.in_sx=e[0].out_sx,this.in_sy=e[0].out_sy,this.in_depth=e[0].out_depth),this.num_inputs=this.in_sx*this.in_sy*this.in_depth,this.out_depth=this.num_inputs},t.prototype.getOutputShape=function(){return[this.out_depth,1,1]},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.num_inputs=this.num_inputs,t},t.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.num_inputs=t.num_inputs},t}(e.BaseLayer);e.SVMLayer=t}(Net||(Net={}));var Net;!function(e){var t=function(e){function t(t){e.call(this,t||{}),this.layer_type="lrn",this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.n%2===0&&console.warn("WARNING n should be odd for LRN layer"),this.updateDimensions(t.pred);
}return __extends(t,e),t.prototype.forward=function(e,t){this.in_act=e,this.resetGradient();var a=e.cloneAndZero();this.S_cache_=e.cloneAndZero();for(var i=Math.floor(this.n/2),o=0;o<e.sx;o++)for(var n=0;n<e.sy;n++)for(var r=0;r<e.depth;r++){for(var p=e.get(o,n,r),l=this.k,s=this.alpha/this.n,d=0,u=Math.max(0,r-i);u<=Math.min(r+i,e.depth-1);u++){var m=e.get(o,n,u);d+=m*m}var h=l+s*d;this.S_cache_.set(o,n,r,h);var y=p*Math.pow(h,-this.beta);a.set(o,n,r,y)}return this.out_act=a,this.out_act},t.prototype.backward=function(){for(var e=this.in_act,t=this.out_act,a=Math.floor(this.n/2),i=0;i<e.sx;i++)for(var o=0;o<e.sy;o++)for(var n=0;n<e.depth;n++){for(var r=this.S_cache_.get(i,o,n),p=e.get(i,o,n),l=t.get_grad(i,o,n),s=Math.pow(r,-this.beta)*l,d=2*this.alpha*this.beta/this.n*p,u=0,m=Math.max(0,n-a);m<=Math.min(n+a,e.depth-1);m++){var h=t.get(i,o,m),y=t.get_grad(i,o,m),f=this.S_cache_.get(i,o,m);u+=y*h/f}var _=s-d*u;e.add_grad(i,o,n,_)}},t.prototype.getDescription=function(){return e.prototype.getDescription.call(this).concat(["n "+this.n+", k "+this.k])},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.k=this.k,t.n=this.n,t.alpha=this.alpha,t.beta=this.beta,t},t.prototype.fromJSON=function(t){e.prototype.fromJSON.call(this,t),this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta},t}(e.BaseLayer);e.LocalResponseNormalizationLayer=t}(Net||(Net={}));var Net;!function(e){var t=function(t){function a(e,a){t.call(this),this.modelPath=e,this.weightPath=a}return __extends(a,t),a.prototype.load=function(){var e=this;return this.fetch(this.modelPath).then(function(t){return e.create(t)}).then(function(t){return e.loadWeights()})},a.prototype.fetch=function(e){var t=new Parser.PrototxtParser;return t.parse(e)},a.prototype.create=function(e){this.name=e.name,this.createLayers(e,e.layer||e.layers,"data"===e.input),this.createEdges()},a.prototype.caffeLayerToJs=function(t){var a,i=this,o={name:t.name,input:t.bottom,output:t.top};switch(void 0!==t.bottom&&(Array.isArray(t.bottom)?o.pred=t.bottom.map(function(e){return i.layers.get(e)}):o.pred=[this.layers.get(t.bottom)]),t.type.toLowerCase()){case"input":var n=t.input_param||{};o.out_depth=+n.shape.dim[1],o.out_sx=+n.shape.dim[2],o.out_sy=+n.shape.dim[3],a=new e.InputLayer(o);break;case"conv":case"convolution":var n=t.param||{},r=t.convolution_param||{};o.sx=void 0!==r.kernel_size?+r.kernel_size:void 0,o.filters=void 0!==r.num_output?+r.num_output:void 0,o.pad=void 0!==r.pad?+r.pad:void 0,o.stride=void 0!==r.stride?+r.stride:void 0,o.l1_decay_mul=n&&n.length&&void 0!==n[0].decay_mult?+n[0].decay_mult:0,o.l2_decay_mul=n&&n.length&&void 0!==n[1].decay_mult?+n[1].decay_mult:1,a=new e.ConvLayer(o);break;case"lrn":var n=t.lrn_param||{};o.k=void 0!==n.k?+n.k:1,o.n=void 0!==n.local_size?+n.local_size:void 0,o.alpha=void 0!==n.alpha?+n.alpha:void 0,o.beta=void 0!==n.beta?+n.beta:void 0,a=new e.LocalResponseNormalizationLayer(o);break;case"dropout":var p=t.dropout_param||{};o.drop_prob=void 0!==p.dropout_ratio?+p.dropout_ratio:void 0,a=new e.DropoutLayer(o);break;case"concat":var r=t.concat_param||{};o.axis=void 0!==r.axis?+r.axis:void 0,a=new e.ConcatLayer(o);break;case"pool":case"pooling":var l=t.pooling_param||{};o.pool=void 0!==l.pool?l.pool:void 0,o.sx=void 0!==l.kernel_size?+l.kernel_size:void 0,o.pad=void 0!==l.pad?+l.pad:void 0,o.stride=void 0!==l.stride?+l.stride:void 0,a=new e.PoolLayer(o);break;case"inner_product":case"innerproduct":var l=t.inner_product_param||{},n=t.param||{};o.num_neurons=void 0!==l.num_output?+l.num_output:void 0,o.l1_decay_mul=n&&n.length&&void 0!==n[0].decay_mult?+n[0].decay_mult:0,o.l2_decay_mul=n&&n.length&&void 0!==n[1].decay_mult?+n[1].decay_mult:1,a=new e.FullyConnectedLayer(o);break;case"softmax":a=new e.SoftmaxLayer(o);break;case"relu":a=new e.ReluLayer(o);break;case"sigmoid":a=new e.SigmoidLayer(o);break;case"tanh":a=new e.TanhLayer(o);break;default:return void console.error("Cannot parse layer "+t.type,t)}this.layers.set(a.name,a)},a.prototype.createLayers=function(t,a,i){var o=this;void 0===i&&(i=!1),this.layers=d3.map(),i&&this.layers.set("data",new e.InputLayer({name:"data",in_depth:+t.input_dim[1],in_sy:+t.input_dim[2],in_sx:+t.input_dim[3]})),a.forEach(function(e){return o.caffeLayerToJs(e)})},a.prototype.createEdges=function(){var e=this;this.edges=[],this.layers.values().filter(function(e){return void 0!==e.input&&e.input!==e.output}).forEach(function(t){Array.isArray(t.input)?t.input.forEach(function(a){e.edges.push({from:a,to:t.output})}):e.edges.push({from:t.input,to:t.output})}),this.layers.values().filter(function(e){return void 0!==e.input&&e.input===e.output}).forEach(function(t){e.edges.filter(function(e){return e.from===t.input}).forEach(function(a){a.from=t.name,e.edges.push({from:t.input,to:t.name})})})},a.prototype.loadWeights=function(){var e=this;return this.weightPath?Promise.all(this.layers.values().filter(function(e){return"conv"==e.layer_type||"fc"==e.layer_type}).map(function(t){return Promise.all([fetch(e.weightPath+t.name+"_filter.bin").then(function(e){return e.arrayBuffer()}).then(function(e){for(var a=new Float32Array(e),i=t.sx*t.sy*t.in_depth,o=0;o<t.out_depth;o++)t.filters[o].w.set(a.slice(o*i,o*i+i))}),fetch(e.weightPath+t.name+"_bias.bin").then(function(e){return e.arrayBuffer()}).then(function(e){var a=new Float32Array(e);t.biases.w.set(a)})])})):Promise.resolve()},a}(e.Net);e.CaffeModel=t}(Net||(Net={}));var ImgJS;!function(e){var t=NumJS,a=function(){function e(e){this.src=e,this.canvas=document.createElement("canvas"),this.image=document.createElement("img")}return e.prototype.set=function(e){return this.data=e.data,this.image.width=e.width,this.image.height=e.height,this},e.prototype.load=function(){var e=this;return new Promise(function(t,a){var i=e.canvas.getContext("2d");e.image.onload=function(){i.imageSmoothingEnabled=!1,e.canvas.width=e.image.width,e.canvas.height=e.image.height,i.drawImage(e.image,0,0);var a=i.getImageData(0,0,e.image.width,e.image.height);e.data=a.data,t(e.data)},e.image.src=e.src})},e.prototype.render=function(e){void 0===e&&(e=this.canvas,document.body.appendChild(e)),e.width=this.image.width,e.height=this.image.height;var t=e.getContext("2d");t.imageSmoothingEnabled=!1;var a=t.getImageData(0,0,this.image.width,this.image.height);a.data.set(this.data),t.putImageData(a,0,0)},e.fromMean=function(t,a,i,o){return void 0===a&&(a=0),void 0===i&&(i=1),void 0===o&&(o=!1),e.fromVol(t,0,[0,1,2],i,o)},e.fromFilter=function(t,a,i,o){return void 0===a&&(a=0),void 0===i&&(i=1),void 0===o&&(o=!0),e.fromVol(t,0,a,i,o)},e.fromVol=function(a,i,o,n,r,p){void 0===o&&(o=[2,1,0]),void 0===n&&(n=1),void 0===r&&(r=!1),void 0===p&&(p=255);var l=new e;i=void 0!==i?i:[0,0,0];for(var s=a.sx,d=a.sy,u=s*d*4,m=t.maxmin(a.w),h=o?o instanceof Array?o[0]:+o:0,y=o?o instanceof Array?o[1]:+o:0,f=o?o instanceof Array?o[2]:+o:0,_=new Uint8ClampedArray(u),c=0;c<d;c++)for(var g=0;g<s;g++){var v=4*(c*s+g),P=i?i instanceof Net.Vol?i.get(g,c,h):+i[h]:0,w=i?i instanceof Net.Vol?i.get(g,c,y):+i[y]:0,N=i?i instanceof Net.Vol?i.get(g,c,f):+i[f]:0,b=a.get(g,c,h),S=a.get(g,c,y),x=a.get(g,c,f);r&&(b=Math.floor((a.get(g,c,h)-m.minv)/m.dv*255),S=Math.floor((a.get(g,c,y)-m.minv)/m.dv*255),x=Math.floor((a.get(g,c,f)-m.minv)/m.dv*255)),_[v+0]=b+P,_[v+1]=S+w,_[v+2]=x+N,_[v+3]=p}return l.image.width=s,l.image.height=d,l.data=_,l},e.prototype.toVol=function(e,t){void 0===t&&(t=[2,1,0]),e=void 0!==e?e:[0,0,0];for(var a=this.image.width,i=this.image.height,o=t[0],n=t[1],r=t[2],p=new Net.Vol(a,i,3,0),l=0;l<i;l++)for(var s=0;s<a;s++){var d=4*(l*a+s),u=e instanceof Net.Vol?e.get(s,l,o):+e[o],m=e instanceof Net.Vol?e.get(s,l,n):+e[n],h=e instanceof Net.Vol?e.get(s,l,r):+e[r];p.set(s,l,o,this.data[d+0]-u),p.set(s,l,n,this.data[d+1]-m),p.set(s,l,r,this.data[d+2]-h)}return p},e}();e.Image=a}(ImgJS||(ImgJS={}));var Utils;!function(e){var t=function(e){function t(){e.call(this)}return __extends(t,e),t.prototype.render=function(e,t){void 0===t&&(t=600);var a=new dagreD3.render,i=this.createGraph(),o=d3.select(e);o.selectAll("*").remove();var n=o.append("svg").attr("width",t),r=n.append("g");a(r,i);var p=(t-i.graph().width)/2;r.attr("transform","translate("+p+", 20)"),n.attr("height",i.graph().height+40)},t.prototype.createGraph=function(){var e=this,t=(new dagreD3.graphlib.Graph).setGraph({}).setDefaultEdgeLabel(function(){return{}});return this.layerIterator(function(e,a,i){t.setNode(e.name,{labelType:"html",label:e.getDescription().join("<br>"),"class":"layer-"+e.layer_type})}),t.nodes().forEach(function(e){var a=t.node(e);a.rx=a.ry=5}),this.edges.filter(function(e){return void 0!==e.from&&void 0!==e.to}).forEach(function(a){t.setEdge(a.from,a.to,{label:e.layers.get(a.from).getOutputShape().join("x")})}),t},t.fromNet=function(e){var a=new t;return a.layers=e.layers,a.edges=e.edges,a},t}(Net.Net);e.GraphDrawer=t}(Utils||(Utils={}));var Utils;!function(e){var t=ImgJS,a=function(e){function a(){e.call(this)}return __extends(a,e),a.prototype.render=function(e){var a=d3.select(e);a.selectAll("*").remove(),this.layerIterator(function(e){a.append("h3").text("Layer type: "+e.name);var i=a.append("div").attr("class","net-layer"),o=i.append("div").attr("class","net-description"),n=i.append("div").attr("class","net-vis"),r=(n.append("div").attr("class","net-weights"),n.append("div").attr("class","net-activations"));o.append("span").text(e.layer_type);for(var p=0,l=e.out_act.depth;p<l;++p){var s=r.append("canvas");t.Image.fromFilter(e.out_act,p,1).render(s[0][0])}})},a.fromNet=function(e){var t=new a;return t.layers=e.layers,t.edges=e.edges,t},a}(Net.Net);e.FilterDrawer=a}(Utils||(Utils={}));